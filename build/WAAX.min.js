var WX=WX||{REVISION:1};console.log("Starting WAAX...(REVISION "+WX.REVISION+")");WX._Templates={};WX._Dictionary=Object.freeze({Fader:"Fader.unit",Oscil:"Oscil.unit",Noise:"Noise.unit",LFO:"LFO.unit",Sampler:"Sampler.unit",LPF:"LPF.unit",ADSR:"ADSR.unit",Compressor:"Compressor.unit",FeedbackDelay:"FeedbackDelay.unit",ConVerb:"ConVerb.unit"});WX._context=new webkitAudioContext;
WX._Unit=function(){Object.defineProperties(this,{_inlet:{value:WX._context.createGainNode(),enumerable:!1,writable:!1},_outlet:{value:WX._context.createGainNode(),enumerable:!1,writable:!1}})};
WX._Unit.prototype=Object.create(null,{to:{enumerable:!1,value:function(a){this._outlet.connect(a._inlet);return a}},cut:{enumerable:!1,value:function(){this._outlet.disconnect()}},toNode:{enumerable:!1,value:function(a){this._outlet.connect(a)}},gain:{enumerable:!0,get:function(){return this._outlet.gain.value},set:function(a){this._outlet.gain.value=a}},params:{enumerable:!1,get:function(){var a=Object.create(null),b;for(b in this)a[b]=this[b];return a},set:function(a){if("object"!==typeof a)WX.error(this,
"invalid JSON.");else for(var b in a)void 0!==this[b]?this[b]=a[b]:WX.error(this,b+" is not available.")}},label:{enumerable:!1,get:function(){return this._label}}});(function(){var a=WX._context.sampleRate,b=5*a,c=new Float32Array(b);WX._Templates.whitenoise=WX._context.createBuffer(1,b,a);for(a=0;a<b;++a)c[a]=2*Math.random()-1;WX._Templates.whitenoise.getChannelData(0).set(c,0)})();WX.PI=Math.PI;WX.TWOPI=2*Math.PI;WX.EPS=Number.MIN_VALUE;WX.C5=261.262;WX.A4=440;WX.midi2freq=function(a){return 440*Math.pow(2,(Math.floor(a)-69)/12)};WX.freq2midi=function(a){return Math.floor(69+12*Math.log(a/440)/Math.log(2))};WX.random2f=function(a,b){return a+Math.random()*(b-a)};WX.random2=function(a,b){return Math.round(a+Math.random()*(b-a))};WX.rms2db=function(){};WX.db2rms=function(){};WX.error=function(a,b){console.log("[WX:"+a.label+"] "+b)};WX.ADSR=function(a){WX._Unit.call(this);Object.defineProperties(this,{_a:{enumerable:!1,writable:!0,value:0.005},_d:{enumerable:!1,writable:!0,value:0.015},_s:{enumerable:!1,writable:!0,value:0.35},_r:{enumerable:!1,writable:!0,value:0.015},_running:{enumerable:!1,writable:!0,value:!1},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.ADSR}});this._inlet.connect(this._outlet);this._inlet.gain.value=0;this.params=a};
WX.ADSR.prototype=Object.create(WX._Unit.prototype,{running:{enumerable:!0,get:function(){return this._running}},a:{enumerable:!0,get:function(){return this._a},set:function(a){this._a=a}},d:{enumerable:!0,get:function(){return this._d},set:function(a){this._d=a}},s:{enumerable:!0,get:function(){return this._s},set:function(a){this._s=a}},r:{enumerable:!0,get:function(){return this._r},set:function(a){this._r=a}},noteOn:{value:function(){var a=WX._context.currentTime;this._inlet.gain.cancelScheduledValues(a);
this._inlet.gain.setValueAtTime(this._inlet.gain.value,a);this._inlet.gain.linearRampToValueAtTime(0,a);this._inlet.gain.linearRampToValueAtTime(1,a+this._a);this._inlet.gain.linearRampToValueAtTime(this._s,a+this._a+this._d);this._running=!0}},noteOff:{value:function(){var a=WX._context.currentTime;this._inlet.gain.cancelScheduledValues(a);this._inlet.gain.setValueAtTime(this._inlet.gain.value,a);this._inlet.gain.linearRampToValueAtTime(0,a+this._r);this._running=!1}}});WX.Comp=function(a){WX._Unit.call(this);Object.defineProperties(this,{_comp:{enumerable:!1,writable:!1,value:WX._context.createDynamicsCompressor()}});this._inlet.connect(this._comp);this._comp.connect(this._outlet);this.params=a};
WX.Comp.prototype=Object.create(WX._Unit.prototype,{threshold:{enumerable:!0,get:function(){return this._comp.threshold.value},set:function(a){this._comp.threshold.value=a}},ratio:{enumerable:!0,get:function(){return this._comp.ratio.value},set:function(a){this._comp.ratio.value=a}},knee:{enumerable:!0,get:function(){return this._comp.knee.value},set:function(a){this._comp.knee.value=a}},attack:{enumerable:!0,get:function(){return this._comp.attack.value},set:function(a){this._comp.attack.value=a}},
release:{enumerable:!0,get:function(){return this._comp.release.value},set:function(a){this._comp.release.value=a}}});WX.Fader=function(){WX._Unit.call(this);Object.defineProperties(this,{_muted:{enumerable:!1,writable:!0,value:!1},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.Fader}});this._inlet.connect(this._outlet);this.params={gain:1}};
WX.Fader.prototype=Object.create(WX._Unit.prototype,{mute:{enumerable:!0,get:function(){return this._muted},set:function(a){!0===a?(this._muted=!0,this._inlet.gain.value=0):(this._muted=!1,this._inlet.gain.value=1)}},db:{enumerable:!0,get:function(){return WX.rms2db(this._outlet.gain.value)},set:function(a){this._outlet.gain.value=WX.db2rms(a)}},modulateWith:{value:function(a){a._outlet.connect(this._inlet.gain)}}});WX.Out=new WX.Fader;WX.Out.toNode(WX._context.destination);WX.FeedbackDelay=function(a){WX._Unit.call(this);Object.defineProperties(this,{_delay:{enumerable:!1,writable:!1,value:WX._context.createDelay()},_fb:{enumerable:!1,writable:!1,value:WX._context.createGain()},_dry:{enumerable:!1,writable:!1,value:WX._context.createGain()},_wet:{enumerable:!1,writable:!1,value:WX._context.createGain()},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.FeedbackDelay}});this._inlet.connect(this._delay);this._inlet.connect(this._dry);this._delay.connect(this._fb);
this._delay.connect(this._wet);this._fb.connect(this._delay);this._dry.connect(this._outlet);this._wet.connect(this._outlet);this.params=a};
WX.FeedbackDelay.prototype=Object.create(WX._Unit.prototype,{delayTime:{enumerable:!0,get:function(){return this._delay.delayTime.value},set:function(a){this._delay.delayTime.value=a}},feedback:{enumerable:!0,get:function(){return this._fb.gain.value},set:function(a){this._fb.gain.value=a}},mix:{enumerable:!0,get:function(){return this._wet.gain.value},set:function(a){this._wet.gain.value=a;this._dry.gain.value=1-a}},modulateWith:{value:function(a){a._outlet.connect(this._delay.delayTime)}}});WX.LFO=function(a){WX._Unit.call(this);Object.defineProperties(this,{_lfo:{enumerable:!1,writable:!1,value:WX._context.createOscillator()},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.LFO}});this._lfo.connect(this._outlet);this._lfo.frequency.value=5;this._lfo.noteOn(0);this.params=a};
WX.LFO.prototype=Object.create(WX._Unit.prototype,{rate:{enumerable:!0,get:function(){return this._lfo.frequency.value},set:function(a){a=Math.max(0,Math.min(20,a));this._lfo.frequency.value=a}},depth:{enumerable:!0,get:function(){return this._outlet.gain.value},set:function(a){this._outlet.gain.value=a}},shape:{enumerable:!0,get:function(){return this._lfo.type},set:function(a){this._lfo.type=a}}});WX.LPF=function(a){WX._Unit.call(this);Object.defineProperties(this,{_lpf:{enumerable:!1,writable:!1,value:WX._context.createBiquadFilter()}});this._inlet.connect(this._lpf);this._lpf.connect(this._outlet);this._lpf.type=0;this.params=a};
WX.LPF.prototype=Object.create(WX._Unit.prototype,{cutoff:{enumerable:!0,get:function(){return this._lpf.frequency.value},set:function(a){this._lpf.frequency.value=a}},Q:{enumerable:!0,get:function(){return this._lpf.Q.value},set:function(a){this._lpf.Q.value=a}},modulateWith:{value:function(a){a._outlet.connect(this._lpf.frequency)}},getFrequencuResponse:{value:function(){return"not implemented yet"}}});WX.Noise=function(a){WX._Unit.call(this);Object.defineProperties(this,{_node:{enumerable:!1,writable:!1,value:WX._context.createBufferSource()},_type:{enumerable:!1,writable:!0,value:"white"},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.Noise}});this._node.connect(this._outlet);this._node.buffer=WX._Templates.whitenoise;this._node.loop=1;this._node.noteOn(0);this.params=a};
WX.Noise.prototype=Object.create(WX._Unit.prototype,{type:{enumerable:!0,get:function(){return this._type},set:function(a){this._type=a}}});WX.Oscil=function(a){WX._Unit.call(this);Object.defineProperties(this,{_oscil:{enumerable:!1,writable:!1,value:WX._context.createOscillator()},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.Oscil}});this._inlet.connect(this._oscil.frequency);this._oscil.connect(this._outlet);this._oscil.noteOn(0);this.params=a||{frequency:440,type:"sine",gain:1}};
WX.Oscil.prototype=Object.create(WX._Unit.prototype,{frequency:{enumerable:!0,get:function(){return this._oscil.frequency.value},set:function(a){this._oscil.frequency.value=a}},type:{enumerable:!0,get:function(){return this._oscil.type},set:function(a){this._oscil.type=a}}});WX.Sampler=function(a){WX._Unit.call(this);Object.defineProperties(this,{_buffer:{enumerable:!1,writable:!0,value:void 0},_node:{enumerable:!1,writable:!0,value:void 0},_url:{enumerable:!1,writable:!0,value:""},_basePitch:{enumerable:!1,writable:!0,value:60},_label:{enumerable:!1,writable:!1,value:WX._Dictionary.Sampler}});this.params=a};
WX.Sampler.prototype=Object.create(WX._Unit.prototype,{source:{enumerable:!0,get:function(){return this._url},set:function(a){if(void 0===a)return WX.error(this,"invalid audio file path."),!1;var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){try{b._buffer=WX._context.createBuffer(c.response,!0)}catch(d){WX.error(b,"file loading error: "+a+" ("+d.message+")")}};c.send();this._url=a;return!0}},basePitch:{enumerable:!0,get:function(){return this._basePitch},
set:function(a){this._basePitch=a}},noteOn:{value:function(a){this._node=WX._context.createBufferSource();this._node.buffer=this._buffer;this._node.connect(this._outlet);void 0!==a&&(a=Math.pow(2,(a-this._basePitch)/12),this._node.playbackRate.setValueAtTime(a,0));this._node.start(0)}},noteOff:{value:function(){this._node&&this._node.stop(0)}}});