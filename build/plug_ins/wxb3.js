!function(WX){"use strict";function WXKey7Voice(synth){this.parent=synth,this.params=synth.params,this.voiceKey=null,this._minDur=null,this._mod=WX.OSC(),this._modGain=WX.Gain(),this._car=WX.OSC(),this._carGain=WX.Gain(),this._mod.to(this._modGain),this._modGain.to(this._car.frequency),this._car.to(this._carGain).to(this.parent._lpf)}function WXKey7(preset){WX.PlugIn.defineType(this,"Generator"),this._lpf=WX.Filter(),this._lpf.to(this._output),WX.defineParams(this,{harmonicRatio:{type:"Generic",name:"HRatio","default":4,min:1,max:60},modulationIndex:{type:"Generic",name:"ModIdx","default":1,min:0,max:2},attack:{type:"Generic",name:"Att","default":.02,min:0,max:5,unit:"Seconds"},decay:{type:"Generic",name:"Dec","default":.04,min:0,max:5,unit:"Seconds"},sustain:{type:"Generic",name:"Sus","default":.25,min:0,max:1},release:{type:"Generic",name:"Rel","default":.2,min:0,max:10,unit:"Seconds"},balance:{type:"Generic",name:"Balance","default":.5,min:0,max:1},filterType:{type:"Itemized",name:"FiltType","default":"lowpass",model:WX.FILTER_TYPES},filterFrequency:{type:"Generic",name:"FiltFreq","default":2500,min:20,max:2e4,unit:"Hertz"},filterQ:{type:"Generic",name:"FiltQ","default":0,min:0,max:40},filterGain:{type:"Generic",name:"FiltGain","default":0,min:-40,max:40,unit:"LinearGain"}}),WX.PlugIn.initPreset(this,preset)}WXKey7Voice.prototype={noteOn:function(pitch,velocity,time){var p=this.params,freq=WX.mtof(pitch),hr=p.harmonicRatio.get(),mi=p.modulationIndex.get(),att=p.attack.get(),dec=p.decay.get(),scale=(p.sustain.get(),WX.veltoamp(velocity));this._mod.start(time),this._car.start(time),this._car.frequency.set(freq,time,0),this._mod.frequency.set(freq*hr,time,0),this._modGain.gain.set(freq*hr*mi,time,0),this._modGain.gain.set(.1,time+1.5,2),this._carGain.gain.set(0,time,0),this._carGain.gain.set(scale,time+att,1),this._carGain.gain.set(p.sustain*scale,[time+att,dec],3),this.minDur=time+att+dec},noteOff:function(pitch,velocity,time){if(this._minDur){time=time<WX.now?WX.now:time;var p=this.params,rel=p.release.get();this.voiceKey=pitch,this._car.gain.set(0,t+this._params.release,2),this._mod.stop(this.minDur+rel+1),this._car.stop(this.minDur+rel+1),time<this.minDur?(this._carGain.gain.cancel(this.minDur),this._carGain.gain.set(0,[this.minDur,rel],3)):this._carGain.gain.set(0,[time,rel],3)}}},WXKey7.prototype={info:{name:"WXKey7",version:"0.0.1",api_version:"1.0.0-alpha",author:"Hongchan Choi",type:"Generator",description:"FM-based Keys"},defaultPreset:{harmonicRatio:4,modulationIndex:1.9379,attack:.02,decay:.07,sustain:.7,release:.76,balance:.7165,filterType:"LP",filterFrequency:5e3,filterQ:0,filterGain:0},$harmonicRatio:function(){},$modulationIndex:function(){},$attack:function(){},$decay:function(){},$sustain:function(){},$release:function(){},$balance:function(){},noteOn:function(){},noteOff:function(){}},WX.PlugIn.extendPrototype(WXKey7,"Generator"),WX.PlugIn.register(WXKey7)}(WX);