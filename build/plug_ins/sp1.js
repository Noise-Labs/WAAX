!function(WX){"use strict";function SP1(preset){WX.Plugin.defineType(this,"Generator"),this.ready=!1,this.bufferRef=null,this._filter=WX.Filter(),this._panner=WX.Panner(),this._filter.to(this._panner).to(this._output),WX.defineParams(this,{tune:{type:"Generic","default":0,min:-48,max:48,unit:"Semitone"},pitchMod:{type:"Boolean","default":!0},velocityMod:{type:"Boolean","default":!0},ampAttack:{type:"Generic","default":.02,min:0,max:5,unit:"Seconds"},ampDecay:{type:"Generic","default":.04,min:0,max:5,unit:"Seconds"},ampSustain:{type:"Generic","default":.25,min:0,max:1,unit:"LinearGain"},ampRelease:{type:"Generic","default":.2,min:0,max:10,unit:"Seconds"},filterType:{type:"Items","default":"lowpass",items:filterTypes,label:"Filter Type"},filterFrequency:{type:"Generic","default":1e3,min:20,max:5e3,unit:"Hertz"},filterQ:{type:"Generic","default":0,min:0,max:40},filterGain:{type:"Generic","default":0,min:-40,max:40,unit:"LinearGain"},filterModAmount:{type:"Generic","default":1,min:.25,max:8},filterDetune:{type:"Generic","default":0,min:0,max:5,unit:"Octave"},filterAttack:{type:"Generic","default":.02,min:0,max:5,unit:"Seconds"},filterHold:{type:"Generic","default":.04,min:0,max:5,unit:"Seconds"},filterRelease:{type:"Generic","default":.2,min:0,max:10,unit:"Seconds"},pan:{type:"Generic","default":.5,min:0,max:1}}),WX.Plugin.initPreset(this,preset)}var filterTypes=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch"];SP1.prototype={info:{name:"SP1",api_version:"1.0.0-alpha",plugin_version:"0.0.1",author:"hoch",type:"instrument",description:"monotonic one-shot sampler (1 sample)"},defaultPreset:{tune:0,pitchMod:!0,velocityMod:!0,ampAttack:.01,ampHold:.44,ampRelease:.06,filterFrequency:140,filterQ:18,filterGain:0,filterModAmount:7,filterDetune:0,filterAttack:.01,filterHold:.07,filterRelease:.03,output:.8},$filterFrequency:function(value,time,rampType){this._filter.frequency.set(value,time,rampType)},$filterQ:function(value,time,rampType){this._filter.Q.set(value,time,rampType)},$filterGain:function(value,time,rampType){this._filter.gain.set(value,time,rampType)},$filterDetune:function(value,time,rampType){this._filter.detune.set(value,time,rampType)},play:function(pitch,velocity,time){if(this.ready){time=time||WX.now;var _buffer=WX.Source(),_env=WX.Gain();_buffer.to(_env).to(this._filter),_buffer.buffer=this.bufferRef,_buffer.playbackRate=Math.pow(2,(this.params.tune.get()+pitch)/1200);var p=this.params,aAtt=p.ampAttack.get(),aHld=p.ampHold.get(),aRls=p.ampRelease.get(),fAmt=1200*p.filterModAmount.get(),fAtt=p.filterAttack.get(),fHld=p.filterHold.get(),fRls=p.filterRelease.get();_buffer.start(time),_env.gain.set(1,[time,aAtt],3),this.$filterDetune(fAmt,[time,fAtt],3),_env.gain.set(1,[time+aAtt,aHld],3),this.$filterDetune(fAmt,[time+fAtt,fHld],3),_env.gain.set(0,[time+aAtt+aHld,aRls],3),this.$filterDetune(0,[time+fAtt+fHld,fRls],3),_buffer.stop(time+fAtt+fHld+fRls)}},onData:function(action,data){switch(action){case"noteon":this.play(data.pitch,data.velocity)}},onLoaded:function(){},isReady:function(){return this.ready},setBuffer:function(bufferRef){this.bufferRef=bufferRef,this.ready=!0},loadClip:function(clip,onloaded){WX.isFunction(onloaded)&&(this.onLoaded=onloaded),WX.loadClip(clip,function(){},function(bufferRef){this.setBuffer(bufferRef),this.onLoaded()}.bind(this))}},WX.Plugin.extendPrototype(SP1,"Generator"),WX.Plugin.register(SP1)}(WX);