WX=function(){var a=new webkitAudioContext,b=function(){};return Object.create(null,{context:{enumerable:!0,get:function(){return a},set:b},sampleRate:{enumerable:!0,get:function(){return a.sampleRate},set:b},now:{enumerable:!0,get:function(){return a.currentTime},set:b},version:{enumerable:!0,get:function(){return"r8"},set:b}})}();WX._log=function(){function a(a,b,e){a+=b;e&&e.label&&(a+=" ("+e.label+")");return a}var b=!0;return{verbose:function(a){"boolean"===typeof a&&(b=a)},post:function(b){console.log(a("[wx] ",b))},info:function(c,d){b&&console.log(a("[wx:info] ",c,d))},warn:function(c,d){b&&console.log(a("[wx:warn] ",c,d))},error:function(b,d){throw Error(a("[wx:err] ",b,d));}}}();
Object.defineProperties(WX,{PI:{value:Math.PI},TWOPI:{value:2*Math.PI},EPS:{value:Number.MIN_VALUE},random2f:{value:function(a,b){return a+Math.random()*(b-a)}},random2:{value:function(a,b){return Math.round(a+Math.random()*(b-a))}},clamp:{value:function(a,b,c){return Math.min(Math.max(a,b),c)}},pitch2freq:{value:function(a){return 440*Math.pow(2,(Math.floor(a)-69)/12)}},freq2pitch:{value:function(a){return Math.floor(69+12*Math.log(a/440)/0.6931471805599453)}},lin2db:{value:function(a){return 20*
(1E-5<a?Math.log(a)/2.302585092994046:-5)}},db2lin:{value:function(a){return Math.pow(10,a/20)}}});
WX._loadBuffer=function(a,b){if(void 0===a||null===a)return WX._log.error("xhr failed (invalid url): "+a),!1;var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){try{var d=WX.context.createBuffer(c.response,!1);b({url:a,buffer:d,status:!0});WX._log.post("loaded: "+a+" ("+d.numberOfChannels+"ch)")}catch(e){WX._log.error("xhr failed ("+e.message+"): "+a)}};c.send();return!0};(function(){WX._log.info("building assets...");WX._builtin={};var a=10*WX.context.sampleRate,b=new Float32Array(a);WX._builtin.whiteNoise=WX.context.createBuffer(1,a,WX.context.sampleRate);for(var c=0;c<a;++c){var d=Math.random(),e=Math.random();0===d&&(d=WX.EPS);b[c]=Math.sqrt(-2*Math.log(d))*Math.cos(2*Math.PI*e)}WX._builtin.whiteNoise.getChannelData(0).set(b,0);a=new Float32Array(WX.context.sampleRate);WX._builtin.dcOffset=WX.context.createBuffer(1,WX.context.sampleRate,WX.context.sampleRate);
for(c=0;c<WX.context.sampleRate;++c)a[c]=1;WX._builtin.dcOffset.getChannelData(0).set(a,0);a=new Float32Array(4096);b=new Float32Array(4096);for(c=0;4096>c;++c)a[c]=1,b[c]=0;WX._builtin.impulse="undefined"===typeof WX.context.createWaveTable?WX.context.createPeriodicWave(a,b):WX.context.createWaveTable(a,b)})();WX._unit=function(){return{extend:function(a,b){for(var c in b)a[c]="label"===c?b[c]+"."+a[c]:b[c]},bindAudioParam:function(a,b){var c=this[a+"_"]=b;this[a]=function(a,b,f){if("undefined"===typeof a)return c.value;b=b||WX.now;if("undefined"===typeof f)return c.cancelScheduledValues(b),c.setValueAtTime(a,b),this;switch(f){case "line":case "l":c.linearRampToValueAtTime(a,b);break;case "expo":case "x":c.exponentialRampToValueAtTime(0===a?1E-4:a,b);break;default:WX._log.warn("invalid transition type. (use 'l' or 'x')",
this)}return this}},factory:function(a){a.map(function(a){WX[a.name]?WX._log.warn("unit name already exists. ("+a.name+")",null):WX[a.name]=function(c){return new a.ref(c)}})}}}();
WX._unit.abstract={_initializeParams:function(a,b){var c={},d;for(d in b)c[d]=b[d];for(var e in a)c[e]=a[e];this.params(c)},params:function(a){if(a)for(var b in a)switch(typeof this[b]){case "function":this[b](a[b]);break;case "number":this[b]=a[b];break;default:case void 0:WX._log.warn("invalid parameters.")}else WX._log.warn("invalid parameter.")},to:function(a){if("u."!==a.label.substr(0,2))WX._log.error("invalid argument. (must be WAAX Unit)",this);else return this._outlet.connect(a._inlet),a},
connect:function(a){"Node"!==a.constructor.name.substr(-4)?WX._log.error("invalid argument. (must be Node)",this):this._outlet.connect(a)},control:function(a){"AudioParam"!==a.constructor.name?WX._log.error("invalid argument. (must be AudioParam)",this):this._outlet.connect(a)},cut:function(){this._outlet.disconnect()}};
WX._unit.generator=function(){this._active=!0;this._outputGain=WX.context.createGain();this._outlet=WX.context.createGain();this._outputGain.connect(this._outlet);WX._unit.bindAudioParam.call(this,"gain",this._outputGain.gain)};WX._unit.generator.prototype={label:"u.gen",on:function(){this._status=!0;this._outputGain.connect(this._outlet)},off:function(){this._status=!1;this._outputGain.disconnect()}};WX._unit.extend(WX._unit.generator.prototype,WX._unit.abstract);
WX._unit.processor=function(){this._active=!0;this._inlet=WX.context.createGain();this._inputGain=WX.context.createGain();this._outputGain=WX.context.createGain();this._outlet=WX.context.createGain();this._inlet.connect(this._inputGain);this._outputGain.connect(this._outlet);WX._unit.bindAudioParam.call(this,"gain",this._outputGain.gain)};
WX._unit.processor.prototype={label:"u.pro",bypass:function(a){"boolean"===typeof a&&(this._active=!a,a?(this._inlet.disconnect(),this._outputGain.disconnect(),this._inlet.connect(this._outlet)):(this._inlet.disconnect(),this._inlet.connect(this._inputGain),this._outputGain.connect(this._outlet)))}};WX._unit.extend(WX._unit.processor.prototype,WX._unit.abstract);
WX._unit.analyzer=function(){this._active=!0;this._inlet=WX.context.createGain();this._inputGain=WX.context.createGain();this._analyzer=WX.context.createAnalyser();this._inlet.connect(this._inputGain);this._inputGain.connect(this._analyzer);WX._unit.bindAudioParam.call(this,"inputGain",this._inputGain.gain)};
WX._unit.analyzer.prototype={label:"u.ana",_initializeParams:function(a,b){var c={},d;for(d in b)c[d]=b[d];for(var e in a)c[e]=a[e];this.params(c)},on:function(){this._status=!0;this._inlet.connect(this._inputGain)},off:function(){this._status=!1;this._inlet.disconnect()}};WX._unit.oscil=function(a){WX._unit.generator.call(this);this._osc=WX.context.createOscillator();this._osc.connect(this._outputGain);this._osc.start(0);WX._unit.bindAudioParam.call(this,"freq",this._osc.frequency);WX._unit.bindAudioParam.call(this,"detune",this._osc.detune);this._initializeParams(a,this._default)};
WX._unit.oscil.prototype={label:"oscil",_default:{type:"sine",freq:440,gain:1,detune:0},type:function(a){var b;switch(a){case "sine":case "sin":case 0:b=0;break;case "square":case "sqr":case 1:b=1;break;case "sawtooth":case "saw":case 2:b=2;break;case "triangle":case "tri":case 3:b=3;break;case void 0:b=-1}if(-1==b)return this._osc.type;this._osc.type=b},stop:function(a){this._osc.stop(a)}};WX._unit.extend(WX._unit.oscil.prototype,WX._unit.generator.prototype);WX._unit.fmop=function(a){WX._unit.generator.call(this);this._mod=WX.context.createOscillator();this._car=WX.context.createOscillator();this._modGain=WX.context.createGain();this._mod.connect(this._modGain);this._modGain.connect(this._car.frequency);this._car.connect(this._outputGain);this._carFreq=220;this._modIndex=this._harmRatio=1;this._mod.start(0);this._car.start(0);WX._unit.bindAudioParam.call(this,"modFreq",this._mod.frequency);WX._unit.bindAudioParam.call(this,"carFreq",this._car.frequency);
WX._unit.bindAudioParam.call(this,"modDetune",this._mod.detune);WX._unit.bindAudioParam.call(this,"carDetune",this._car.detune);WX._unit.bindAudioParam.call(this,"modGain",this._modGain.gain);this._initializeParams(a,this._default)};
WX._unit.fmop.prototype={label:"fmop",_default:{freq:220,harmRatio:4,modIndex:0.1},freq:function(a,b,c){return void 0!==a?(this._carFreq=a,this.carFreq(a,b,c)):this._carFreq},harmRatio:function(a,b,c){return void 0!==a?(this._harmRatio=a,this.modFreq(this._carFreq*this._harmRatio,b,c)):this._harmRatio},modIndex:function(a,b,c){return void 0!==a?(this._modIndex=a,this.modGain(this._carFreq*this._harmRatio*this._modIndex,b,c)):this._modIndex},stop:function(a){this._mod.stop(a);this._car.stop(a)}};
WX._unit.extend(WX._unit.fmop.prototype,WX._unit.generator.prototype);WX._unit.noise=function(a){WX._unit.generator.call(this);this._noise=WX.context.createBufferSource();this._noise.connect(this._outputGain);this._noise.buffer=WX._builtin.whiteNoise;this._noise.loop=1;this._noise.loopStart=Math.random()*this._noise.buffer.duration;this._noise.start(0);WX._unit.bindAudioParam.call(this,"rate",this._noise.playbackRate);this._initializeParams(a,this._default)};WX._unit.noise.prototype={label:"noise",_default:{type:"white",gain:1},stop:function(a){this._noise.stop(a)}};
WX._unit.extend(WX._unit.noise.prototype,WX._unit.generator.prototype);WX._unit.itrain=function(a){WX._unit.generator.call(this);this._impulse=WX.context.createOscillator();this._impulse.connect(this._outputGain);"undefined"===typeof this._impulse.setWaveTable?this._impulse.setPeriodicWave(WX._builtin.impulse):this._impulse.setWaveTable(WX._builtin.impulse);this._impulse.start(0);WX._unit.bindAudioParam.call(this,"freq",this._impulse.frequency);WX._unit.bindAudioParam.call(this,"detune",this._impulse.detune);this._initializeParams(a,this._default)};
WX._unit.itrain.prototype={label:"itrain",_default:{freq:1,gain:1},stop:function(a){this._impulse.stop(a||WX.now)}};WX._unit.extend(WX._unit.itrain.prototype,WX._unit.generator.prototype);WX._unit.sampler=function(a){WX._unit.generator.call(this);this._player=this._buffer=null;this._basePitch=60;this._ready=!1;this._url=null;this._loop=!1;var b=this;this._oncomplete=function(a){b._url=a.url;b._buffer=a.buffer;b._ready=a.status};this._initializeParams(a,this._default)};
WX._unit.sampler.prototype={label:"sampler",_default:{basePitch:60,loop:!1},source:function(a){if(a)WX._loadBuffer(a,this._oncomplete);else return this._url},basePitch:function(a){if(a)this._basePitch=a;else return this._basePitch},duration:function(){return this._buffer.duration},loop:function(a){this._loop=a},start:function(a,b){this._player=WX.context.createBufferSource();this._player.buffer=this._buffer;this._loop&&(this._player.loop=1);this._player.connect(this._outputGain);if(void 0!==a){var c=
Math.pow(2,(a-this._basePitch)/12);this._player.playbackRate.setValueAtTime(c,b||WX.now)}this._player.start(b||WX.now);return this},stop:function(a){this._player&&this._player.stop(a||WX.now)}};WX._unit.extend(WX._unit.sampler.prototype,WX._unit.generator.prototype);WX._unit.step=function(a){WX._unit.generator.call(this);this._step=WX.context.createBufferSource();this._step.buffer=WX._builtin.dcOffset;this._step.connect(this._outputGain);this._step.start(0);this._step.loop=1;this._step.loopEnd=1;this._initializeParams(a,this._default)};WX._unit.step.prototype={label:"step",_default:{gain:1},stop:function(a){this._step.stop(a||WX.now)}};WX._unit.extend(WX._unit.step.prototype,WX._unit.generator.prototype);WX._unit.fader=function(a){WX._unit.processor.call(this);this._inverter=WX.context.createGain();this._splitter=WX.context.createChannelSplitter(2);this._left=WX.context.createGain();this._right=WX.context.createGain();var b=WX.context.createChannelMerger(2);this._inputGain.connect(this._inverter);this._inverter.connect(this._splitter);this._left.connect(b,0,0);this._right.connect(b,0,1);b.connect(this._outputGain);this._position=0;WX._unit.bindAudioParam.call(this,"inputGain",this._inputGain.gain);
WX._unit.bindAudioParam.call(this,"gainLeft",this._left.gain);WX._unit.bindAudioParam.call(this,"gainRight",this._right.gain);this._initializeParams(a,this._default)};
WX._unit.fader.prototype={label:"fader",_default:{type:"stereo",panner:0.5,gain:1},db:function(a,b,c){return void 0!==a?this.gain(WX.db2lin(a),b,c):WX.lin2db(this.gain())},mute:function(a,b){return"boolean"===typeof a?this.inputGain(a?0:1,b):0===this.inputGain()?!0:!1},panner:function(a,b,c){return void 0!==a?(this._position=a=Math.min(1,Math.max(0,a)),this.gainLeft(Math.sqrt(a),b,c),this.gainRight(Math.sqrt(1-a),b,c),this):this._position},invert:function(a,b){return"boolean"===typeof a?(this._inverter.gain.setValueAtTime(a?
-1:1,b||WX.now),this):-1==this._inverter.gain.value?!0:!1},type:function(a){this._splitter.disconnect();"stereo"===a?(this._splitter.connect(this._left,0,0),this._splitter.connect(this._right,1,0)):(this._splitter.connect(this._left,0,0),this._splitter.connect(this._right,0,0))}};WX._unit.extend(WX._unit.fader.prototype,WX._unit.processor.prototype);WX._unit.spatter=function(a){WX._unit.processor.call(this);this._inverter=WX.context.createGain();this._delay=WX.context.createDelay();this._panner=WX.context.createPanner();this._inputGain.connect(this._inverter);this._inverter.connect(this._delay);this._delay.connect(this._panner);this._panner.connect(this._outputGain);this._delay.delayTime=0.01;this._position={x:0,y:1,z:0};WX._unit.bindAudioParam.call(this,"delayTime",this._delay.delayTime);this._initializeParams(a,this._default)};
WX._unit.spatter.prototype={label:"spatter",_default:{panner:{x:0,y:1,z:0},gain:1},invert:function(a,b){return"boolean"===typeof a?(this._inverter.gain.setValueAtTime(a?-1:1,b||WX.now),this):-1==this._inverter.gain.value?!0:!1},panner:function(a){return void 0!==a?(this._panner.setPosition(a.x,a.y,a.z),this._position=a,this):this._position}};WX._unit.extend(WX._unit.spatter.prototype,WX._unit.processor.prototype);WX._unit.adsr=function(a){WX._unit.processor.call(this);this._inputGain.connect(this._outputGain);this._attack=0.005;this._decay=0.015;this._sustain=0.35;this._release=0.05;this._releaseTau=this._release/this._tau;this._sustainOnset=0;this._isRunning=!1;WX._unit.bindAudioParam.call(this,"envelope",this._inputGain.gain);this.envelope(0);this._initializeParams(a,this._default)};
WX._unit.adsr.prototype={label:"adsr",_tau:Math.log(0.01),_default:{attack:0.015,decay:0.015,sustain:0.3,release:0.05},attack:function(a){if(void 0!==a)this._attack=a;else return this._attack},decay:function(a){if(void 0!==a)this._decay=a;else return this._decay},sustain:function(a){if(void 0!==a)this._sustain=a=Math.max(1E-7,Math.min(1,a));else return this._sustain},release:function(a){if(void 0!==a)this._release=a,this._releaseTau=-this._release/this._tau;else return this._release},adsr:function(a,
b,c,d){this.attack(a);this.decay(b);this.sustain(c);this.release(d);return this},noteOn:function(a){a=a||WX.now;var b=this._inputGain.gain;this._sustainOnset=a+this._attack+this._decay;b.cancelScheduledValues(a);b.setValueAtTime(b.value,a);b.linearRampToValueAtTime(1,a+this._attack);b.exponentialRampToValueAtTime(this._sustain,this._sustainOnset);this._isRunning=!0;return this},noteOff:function(a){a=a||WX.now;var b=this._inputGain.gain;b.cancelScheduledValues(a);b.setValueAtTime(b.value,a);b.setTargetValueAtTime(1E-7,
a,this._releaseTau);this._isRunning=!1;return this}};WX._unit.extend(WX._unit.adsr.prototype,WX._unit.processor.prototype);WX._unit.filter=function(a){WX._unit.processor.call(this);this._filter=WX.context.createBiquadFilter();this._inputGain.connect(this._filter);this._filter.connect(this._outputGain);this._filter.type="lowpass";WX._unit.bindAudioParam.call(this,"cutoff",this._filter.frequency);WX._unit.bindAudioParam.call(this,"Q",this._filter.Q);WX._unit.bindAudioParam.call(this,"detune",this._filter.detune);this._initializeParams(a,this._default)};
WX._unit.filter.prototype={label:"filter",_default:{cutoff:1E3,Q:1},type:function(a){return void 0!==a?(this._filter.type=a,this):this._filter.type}};WX._unit.extend(WX._unit.filter.prototype,WX._unit.processor.prototype);WX._unit.formant=function(a){WX._unit.processor.call(this);this._f=[];this._g=[];for(var b=0;5>b;++b)this._f[b]=WX.context.createBiquadFilter(),this._g[b]=WX.context.createGain(),this._inputGain.connect(this._f[b]),this._f[b].connect(this._g[b]),this._g[b].connect(this._outputGain),this._f[b].type="bandpass",WX._unit.bindAudioParam.call(this,"f"+b+"freq",this._f[b].frequency),WX._unit.bindAudioParam.call(this,"f"+b+"Q",this._f[b].Q),WX._unit.bindAudioParam.call(this,"f"+b+"gain",this._g[b].gain);
this._vowel="a";this._initializeParams(a,this._default)};
WX._unit.formant.prototype={label:"formant",_default:{vowel:"a"},_presets:{a:{freq:[800,1150,2800,3500,4950],bw:[80,90,120,130,140],amp:[0,-4,-20,-36,-60]},e:{freq:[400,1600,2700,3300,4950],bw:[60,80,120,150,200],amp:[0,-24,-30,-35,-60]},i:{freq:[350,1700,2700,3700,4950],bw:[50,100,120,150,200],amp:[0,-20,-30,-36,-60]},o:{freq:[450,800,2830,3500,4950],bw:[70,80,100,130,135],amp:[0,-9,-16,-28,-55]},u:{freq:[325,700,2530,3500,4950],bw:[50,60,170,180,200],amp:[0,-12,-30,-40,-64]}},_changeFormants:function(a,
b,c){for(var d=0;5>d;++d)this["f"+d+"freq"](a.freq[d],b,c),this["f"+d+"Q"](a.freq[d]/a.bw[d],b,c),this["f"+d+"gain"](WX.db2lin(a.amp[d]),b,c)},vowel:function(a,b,c){if(void 0!==a){if("a"==a||"e"==a||"i"==a||"o"==a||"u"==a)return this._changeFormants(this._presets[a],b,c),this._vowel=a,this}else return this._vowel}};WX._unit.extend(WX._unit.formant.prototype,WX._unit.processor.prototype);WX._unit.formantv=function(a){WX._unit.processor.call(this);this._f=[];this._g=[];for(var b=0;5>b;++b)this._f[b]=WX.context.createBiquadFilter(),this._g[b]=WX.context.createGain(),this._inputGain.connect(this._f[b]),this._f[b].connect(this._g[b]),this._g[b].connect(this._outputGain),this._f[b].type="bandpass",WX._unit.bindAudioParam.call(this,"f"+b+"freq",this._f[b].frequency),WX._unit.bindAudioParam.call(this,"f"+b+"Q",this._f[b].Q),WX._unit.bindAudioParam.call(this,"f"+b+"gain",this._g[b].gain);
this._vowel="a";this._tFreq=[];this._tQ=[];this._tAmp=[];this._initializeParams(a,this._default)};
WX._unit.formantv.prototype={label:"formant",_default:{vowel:"a"},_formants:{a:{freq:[800,1150,2800,3500,4950],bw:[80,90,120,130,140],amp:[1,0.6309573444801932,0.1,0.015848931924611134,0.001]},e:{freq:[400,1600,2700,3300,4950],bw:[60,80,120,150,200],amp:[1,0.06309573444801933,0.03162277660168379,0.01778279410038923,0.001]},i:{freq:[350,1700,2700,3700,4950],bw:[50,100,120,150,200],amp:[1,0.1,0.03162277660168379,0.015848931924611134,0.001]},o:{freq:[450,800,2830,3500,4950],bw:[70,80,100,130,135],amp:[1,
0.35481338923357547,0.15848931924611134,0.039810717055349734,0.0017782794100389228]},u:{freq:[325,700,2530,3500,4950],bw:[50,60,170,180,200],amp:[1,0.251188643150958,0.03162277660168379,0.01,6.30957344480193E-4]}},_points:[[0,1],[-0.9510565162951535,0.3090169943749475],[-0.5877852522924732,-0.8090169943749473],[0.5877852522924729,-0.8090169943749476],[0.9510565162951536,0.3090169943749472]],_calculateVector:function(a,b){for(var c=[],d=0,e=0;5>e;++e){var f=a-this._points[e][0],g=b-this._points[e][1],
f=Math.sqrt(f*f+g*g);0!==f&&(c[e]=1/f,d+=c[e])}d=1/d;for(e=0;5>e;++e)this._tFreq[e]=c[0]*this._formants.a.freq[e]+c[1]*this._formants.e.freq[e]+c[2]*this._formants.i.freq[e]+c[3]*this._formants.o.freq[e]+c[4]*this._formants.u.freq[e],this._tFreq[e]*=d,this._tQ[e]=c[0]*this._formants.a.freq[e]/this._formants.a.bw[e]+c[1]*this._formants.e.freq[e]/this._formants.e.bw[e]+c[2]*this._formants.i.freq[e]/this._formants.i.bw[e]+c[3]*this._formants.o.freq[e]/this._formants.o.bw[e]+c[4]*this._formants.u.freq[e]/
this._formants.u.bw[e],this._tQ[e]*=d,this._tAmp[e]=c[0]*this._formants.a.amp[e]+c[1]*this._formants.e.amp[e]+c[2]*this._formants.i.amp[e]+c[3]*this._formants.o.amp[e]+c[4]*this._formants.u.amp[e],this._tAmp[e]*=d},_changeFormants:function(a,b,c){for(var d=0;5>d;++d)this["f"+d+"freq"](a.freq[d],b,c),this["f"+d+"Q"](a.freq[d]/a.bw[d],b,c),this["f"+d+"gain"](a.amp[d],b,c)},setPosition:function(a,b,c){this._calculateVector(a,b);for(a=0;5>a;++a)this["f"+a+"freq"](this._tFreq[a],WX.now+c,"x"),this["f"+
a+"Q"](this._tQ[a],WX.now+c,"l"),this["f"+a+"gain"](this._tAmp[a],WX.now+c,"l")},vowel:function(a,b,c){if(void 0!==a){if("a"==a||"e"==a||"i"==a||"o"==a||"u"==a)return this._changeFormants(this._formants[a],b,c),this._vowel=a,this}else return this._vowel}};WX._unit.extend(WX._unit.formantv.prototype,WX._unit.processor.prototype);WX._unit.chorus=function(a){WX._unit.processor.call(this);var b=WX.context.createChannelSplitter(),c=WX.context.createChannelMerger();this._dry=WX.context.createGain();this._wet=WX.context.createGain();this._sL=WX.context.createGain();this._delayVL=WX.context.createDelay();this._delayFL=WX.context.createDelay();this._fbL=WX.context.createGain();this._ffL=WX.context.createGain();this._blendL=WX.context.createGain();this._sR=WX.context.createGain();this._delayVR=WX.context.createDelay();this._delayFR=
WX.context.createDelay();this._fbR=WX.context.createGain();this._ffR=WX.context.createGain();this._blendR=WX.context.createGain();b.connect(this._sL,0,0);this._sL.connect(this._delayFL);this._sL.connect(this._delayVL);this._delayFL.connect(this._fbL);this._fbL.connect(this._sL);this._delayVL.connect(this._ffL);this._delayVL.connect(c,0,0);this._blendL.connect(c,0,0);b.connect(this._sR,1,0);this._sR.connect(this._delayFR);this._sR.connect(this._delayVR);this._delayFR.connect(this._fbR);this._fbR.connect(this._sR);
this._delayVR.connect(this._ffR);this._delayVR.connect(c,0,1);this._blendR.connect(c,0,1);c.connect(this._wet);this._lfo=WX.context.createOscillator();this._lfo.type="sine";this._depthL=WX.context.createGain();this._depthR=WX.context.createGain();this._lfo.frequency.value=0.18;this._depthL.gain.value=0.01;this._depthR.gain.value=-0.011;this._lfo.start(0);this._lfo.connect(this._depthL);this._lfo.connect(this._depthR);this._depthL.connect(this._delayVL.delayTime);this._depthR.connect(this._delayVR.delayTime);
this._delayVL.delayTime.value=0.017;this._delayFL.delayTime.value=0.011;this._delayVR.delayTime.value=0.013;this._delayFR.delayTime.value=0.019;this._inputGain.connect(b);this._inputGain.connect(this._dry);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);WX._unit.bindAudioParam.call(this,"lfoFreq",this._lfo.frequency);WX._unit.bindAudioParam.call(this,"lfoDepthLeft",this._depthL.gain);WX._unit.bindAudioParam.call(this,"lfoDepthRight",this._depthR.gain);WX._unit.bindAudioParam.call(this,
"feedbackLeft",this._fbL.gain);WX._unit.bindAudioParam.call(this,"feedbackRight",this._fbR.gain);WX._unit.bindAudioParam.call(this,"feedforwardLeft",this._ffL.gain);WX._unit.bindAudioParam.call(this,"feedforwardRight",this._ffR.gain);WX._unit.bindAudioParam.call(this,"blendLeft",this._blendL.gain);WX._unit.bindAudioParam.call(this,"blendRight",this._blendR.gain);WX._unit.bindAudioParam.call(this,"dry",this._dry.gain);WX._unit.bindAudioParam.call(this,"wet",this._wet.gain);this._initializeParams(a,
this._default)};
WX._unit.chorus.prototype={label:"chorus",_default:{feedback:0.1,feedforward:0.70701,blend:1,mix:0.8},rate:function(a,b,c){return void 0!==a?this.lfoFreq(0.01*(29*a+1),b,c):this.lfoFreq()},depth:function(a,b,c){return void 0!==a?this.lfoDepthLeft(0.05*a,b,c).lfoDepthRight(0.05*-a,b,c):[this.lfoDepthLeft(),this.lfoDepthRight()]},feedback:function(a,b,c){return void 0!==a?this.feedbackLeft(-a,b,c).feedbackRight(-a,b,c):[this.feedbackLeft(),this.feedbackRight()]},feedforward:function(a,b,c){return void 0!==
a?this.feedforwardLeft(a,b,c).feedforwardRight(a,b,c):[this.feedforwardLeft(),this.feedforwardRight()]},blend:function(a,b,c){return void 0!==a?this.blendLeft(a,b,c).blendRight(a,b,c):[this.blendLeft(),this.blendRight()]},mix:function(a,b,c){return void 0!==a?this.dry(1-a,b,c).wet(a,b,c):this.wet()}};WX._unit.extend(WX._unit.chorus.prototype,WX._unit.processor.prototype);WX._unit.phasor=function(a){WX._unit.processor.call(this);var b=WX.context.createChannelSplitter(),c=WX.context.createChannelMerger();this._dry=WX.context.createGain();this._wet=WX.context.createGain();this._notch=[];for(var d=0;12>d;++d)this._notch[d]=WX.context.createBiquadFilter(),this._notch[d].type="notch",this._notch[d].frequency=60+Math.pow(2,d);b.connect(this._notch[0],0,0);b.connect(this._notch[1],1,0);for(d=0;10>d;d+=2)this._notch[d].connect(this._notch[d+2]),this._notch[d+1].connect(this._notch[d+
3]);this._notch[10].connect(c,0,0);this._notch[11].connect(c,0,1);c.connect(this._wet);this._lfo=WX.context.createOscillator();this._depthL=WX.context.createGain();this._depthR=WX.context.createGain();this._lfo.type="triangle";this._lfo.start(0);this._lfo.frequency.value=4;this._depthL.gain.value=200;this._depthR.gain.value=-200;this._lfo.connect(this._depthL);this._lfo.connect(this._depthR);for(c=0;12>c;++c)0===c%2?this._depthL.connect(this._notch[c].frequency):this._depthR.connect(this._notch[c].frequency);
this._inputGain.connect(b);this._inputGain.connect(this._dry);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);WX._unit.bindAudioParam.call(this,"lfoFreq",this._lfo.frequency);WX._unit.bindAudioParam.call(this,"lfoDepthLeft",this._depthL.gain);WX._unit.bindAudioParam.call(this,"lfoDepthRight",this._depthR.gain);WX._unit.bindAudioParam.call(this,"dry",this._dry.gain);WX._unit.bindAudioParam.call(this,"wet",this._wet.gain);this._initializeParams(a,this._default)};
WX._unit.phasor.prototype={label:"phasor",_default:{mix:0.8},rate:function(a,b,c){return void 0!==a?this.lfoFreq(0.01*(29*a+1),b,c):this.lfoFreq()},depth:function(a,b,c){return void 0!==a?this.lfoDepthLeft(a,b,c).lfoDepthRight(-a,b,c):[this.lfoDepthLeft(),this.lfoDepthRight()]},mix:function(a,b,c){return void 0!==a?this.dry(1-a,b,c).wet(a,b,c):this.wet()}};WX._unit.extend(WX._unit.phasor.prototype,WX._unit.processor.prototype);WX._unit.comp=function(a){WX._unit.processor.call(this);this._comp=WX.context.createDynamicsCompressor();this._inputGain.connect(this._comp);this._comp.connect(this._outputGain);WX._unit.bindAudioParam.call(this,"inputGain",this._inputGain.gain);WX._unit.bindAudioParam.call(this,"threshold",this._comp.threshold);WX._unit.bindAudioParam.call(this,"knee",this._comp.knee);WX._unit.bindAudioParam.call(this,"ratio",this._comp.ratio);WX._unit.bindAudioParam.call(this,"attack",this._comp.attack);WX._unit.bindAudioParam.call(this,
"release",this._comp.release);this._initializeParams(a,this._default)};WX._unit.comp.prototype={label:"comp",_default:{threshold:-24,knee:0,ratio:4,attack:0.003,release:0.25,gain:1},makeup:function(a,b,c){a=WX.db2lin(a);this.gain(a,b,c)}};WX._unit.extend(WX._unit.comp.prototype,WX._unit.processor.prototype);WX._unit.pingpong=function(a){WX._unit.processor.call(this);this._delayL=WX.context.createDelay();this._delayR=WX.context.createDelay();this._fbL=WX.context.createGain();this._fbR=WX.context.createGain();this._crosstalkL=WX.context.createGain();this._crosstalkR=WX.context.createGain();this._merger=WX.context.createChannelMerger(2);this._dry=WX.context.createGain();this._wet=WX.context.createGain();this._inputGain.connect(this._delayL);this._inputGain.connect(this._delayR);this._inputGain.connect(this._dry);
this._delayL.connect(this._fbL);this._delayR.connect(this._fbR);this._fbL.connect(this._delayL);this._fbR.connect(this._delayR);this._fbL.connect(this._crosstalkR);this._fbR.connect(this._crosstalkL);this._crosstalkR.connect(this._delayR);this._crosstalkL.connect(this._delayL);this._delayL.connect(this._merger,0,0);this._delayR.connect(this._merger,0,1);this._merger.connect(this._wet);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);WX._unit.bindAudioParam.call(this,"delayTimeLeft",
this._delayL.delayTime);WX._unit.bindAudioParam.call(this,"delayTimeRight",this._delayR.delayTime);WX._unit.bindAudioParam.call(this,"feedbackLeft",this._fbL.gain);WX._unit.bindAudioParam.call(this,"feedbackRight",this._fbR.gain);WX._unit.bindAudioParam.call(this,"crosstalkLeft",this._crosstalkL.gain);WX._unit.bindAudioParam.call(this,"crosstalkRight",this._crosstalkR.gain);WX._unit.bindAudioParam.call(this,"dry",this._dry.gain);WX._unit.bindAudioParam.call(this,"wet",this._wet.gain);this._initializeParams(a,
this._default)};
WX._unit.pingpong.prototype={label:"pingpong",_default:{delayTimeLeft:0.125,delayTimeRight:0.25,feedback:0.25,crosstalk:0.1,mix:0.5},delayTime:function(a,b,c){return void 0!==a?this.delayTimeLeft(a,b,c).delayTimeRight(a,b,c):[this.delayTimeLeft(),this.delayTimeRight()]},crosstalk:function(a,b,c){return void 0!==a?this.crosstalkLeft(a,b,c).crosstalkRight(a,b,c):[this.crosstalkLeft(),this.crosstalkRight()]},feedback:function(a,b,c){return void 0!==a?this.feedbackLeft(a,b,c).feedbackRight(a,b,c):[this.feedbackLeft(),
this.feedbackRight()]},mix:function(a,b,c){return void 0!==a?this.dry(1-a,b,c).wet(a,b,c):this.wet()}};WX._unit.extend(WX._unit.pingpong.prototype,WX._unit.processor.prototype);WX._unit.converb=function(a){WX._unit.processor.call(this);this._convolver=WX.context.createConvolver();this._dry=WX.context.createGain();this._wet=WX.context.createGain();this._inputGain.connect(this._convolver);this._inputGain.connect(this._dry);this._convolver.connect(this._wet);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);this._ready=!1;this._url=null;var b=this;this._oncomplete=function(a){b._url=a.url;b._convolver.buffer=a.buffer;b._ready=a.status};WX._unit.bindAudioParam.call(this,
"dry",this._dry.gain);WX._unit.bindAudioParam.call(this,"wet",this._wet.gain);this._initializeParams(a,this._default)};WX._unit.converb.prototype={label:"converb",_default:{source:"../data/ir/hall.wav",mix:0.1},source:function(a){if(a)WX._loadBuffer(a,this._oncomplete);else return this._url},mix:function(a,b,c){return void 0!==a?(this.dry(1-a,b,c),this.wet(a,b,c)):this.wet()}};WX._unit.extend(WX._unit.converb.prototype,WX._unit.processor.prototype);WX._unit.waveform=function(a){WX._unit.analyzer.call(this);this._context2D=null;this._buffer=new Uint8Array(this._analyzer.frequencyBinCount);this._pause=!1;this._autoclear=!0;this._initializeParams(a,this._default)};
WX._unit.waveform.prototype={label:"waveform",_default:{},_updateSize:function(){this._unitX=this._context2D.canvas.width/this._buffer.length;this._scaleY=this._context2D.canvas.height},context:function(a){if(void 0===a)return this._context2D;"CanvasRenderingContext2D"!==a.constructor.name?WX.error(this,"invalid drawing context."):(this._context2D=a,this._updateSize())},pause:function(a){if("undefined"===typeof a)return this._pause;this._pause=a},autoClear:function(a){if("undefined"===typeof a)return this._autoclear;
this._autoclear=a},draw:function(){if(!this._pause){this._analyzer.getByteTimeDomainData(this._buffer);var a=this._context2D;this._autoclear&&a.clearRect(0,0,a.canvas.width,a.canvas.height);a.beginPath();a.moveTo(0,(1-this._buffer[0]/255)*this._scaleY);for(var b=1,c=this._buffer.length;b<c;++b)a.lineTo(b*this._unitX,(1-this._buffer[b]/255)*this._scaleY);a.stroke()}}};WX._unit.extend(WX._unit.waveform.prototype,WX._unit.generator.prototype);WX._unit.spectrum=function(a){WX._unit.analyzer.call(this);this._analyzer.maxDecibels=0;this._analyzer.minDecibels=-100;this._analyzer.smoothingTimeConstant=0.8;this._context2D=null;this._buffer=new Float32Array(this._analyzer.frequencyBinCount);this._pause=!1;this._autoclear=!0;this._grid=!1;this._renderParams={binCount:this._analyzer.frequencyBinCount,binSize:WX.context.sampleRate/this._analyzer.frequencyBinCount,logbase:2,logmax:Math.log((this._analyzer.frequencyBinCount-1)/1,2),xAxisLabel:[30,
65,125,250,500,1E3,2E3,4E3,8E3,16E3]};this._initializeParams(a,this._default)};
WX._unit.spectrum.prototype={label:"spectrum",_default:{pause:!1,autoClear:!0},_updateSize:function(){this._baseX=this._context2D.canvas.width/4;this._unitX=this._context2D.canvas.width/this._buffer.length;this._scaleY=this._context2D.canvas.height},context:function(a){if(void 0===a)return this._context2D;"CanvasRenderingContext2D"!==a.constructor.name?WX.error(this,"invalid drawing context."):(this._context2D=a,this._updateSize())},pause:function(a){if("undefined"===typeof a)return this._pause;this._pause=
a},autoClear:function(a){if("undefined"===typeof a)return this._autoclear;this._autoclear=a},grid:function(a){if("undefined"===typeof a)return this._grid;this._grid=a},smoothingFactor:function(a){if("undefined"===typeof a)return this._analyzer.smoothingTimeConstant;a=Math.min(1,Math.max(0,a));this._analyzer.smoothingTimeConstant=a},draw:function(){if(!this._pause){var a=this._context2D;this._autoclear&&a.clearRect(0,0,a.canvas.width,a.canvas.height);if(this._grid){a.lineWidth=0.5;a.strokeStyle="#333";
a.beginPath();for(var b=0.5*WX.context.sampleRate,c=0;10>c;++c){var d=c*a.canvas.width/10,e=b*Math.pow(2,c-10);a.moveTo(d,0);a.lineTo(d,a.canvas.height);a.fillText(~~e+"Hz",d+5,a.canvas.height-10)}d=100/6;for(b=0;b<d;++b)c=b*a.canvas.height/d,e=0+-6*b,a.moveTo(0,c),a.lineTo(a.canvas.width,c),a.fillText(~~e+"dB",a.canvas.width-30,c+15);a.stroke()}this._analyzer.getFloatFrequencyData(this._buffer);a.beginPath();for(b=1;b<this._renderParams.binCount;++b)d=a.canvas.width*Math.log(b/1,this._renderParams.logbase)/
this._renderParams.logmax,a.lineTo(d,-0.01*this._buffer[b]*this._scaleY);a.stroke()}}};WX._unit.extend(WX._unit.spectrum.prototype,WX._unit.generator.prototype);(function(){WX._log.info("building unit factory...");WX._unit.factory([{name:"Oscil",ref:WX._unit.oscil},{name:"Fmop",ref:WX._unit.fmop},{name:"Noise",ref:WX._unit.noise},{name:"ITrain",ref:WX._unit.itrain},{name:"Sampler",ref:WX._unit.sampler},{name:"Step",ref:WX._unit.step},{name:"Fader",ref:WX._unit.fader},{name:"Spatter",ref:WX._unit.spatter},{name:"ADSR",ref:WX._unit.adsr},{name:"Filter",ref:WX._unit.filter},{name:"Filterbank",ref:WX._unit.filterbank},{name:"Formant",ref:WX._unit.formant},{name:"FormantV",
ref:WX._unit.formantv},{name:"Pingpong",ref:WX._unit.pingpong},{name:"Chorus",ref:WX._unit.chorus},{name:"Phasor",ref:WX._unit.phasor},{name:"Comp",ref:WX._unit.comp},{name:"Converb",ref:WX._unit.converb},{name:"Waveform",ref:WX._unit.waveform},{name:"Spectrum",ref:WX._unit.spectrum}]);WX.DAC=WX.Fader();WX.DAC.connect(WX.context.destination);WX._log.info("master fader created. (WX.DAC)");WX._log.post("waax ("+WX.version+") is ready.");WX._log.verbose(!1)})();
