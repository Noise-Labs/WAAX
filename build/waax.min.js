(function(){function a(a){a&&!a.setTargetAtTime&&(a.setTargetAtTime=a.setTargetValueAtTime)}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var b=this.internal_createGain();a(b.gain);return b},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=
function(){var b=this.internal_createDelay();a(b.delayTime);return b},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var b=this.internal_createBufferSource();b.start||(b.start=function(a,b,e){b||e?this.noteGrainOn(a,b,e):this.noteOn(a)});b.stop||(b.stop=b.noteoff);a(b.playbackRate);return b},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=
function(){var b=this.internal_createDynamicsCompressor();a(b.threshold);a(b.knee);a(b.ratio);a(b.reduction);a(b.attack);a(b.release);return b},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var b=this.internal_createBiquadFilter();a(b.frequency);a(b.detune);a(b.Q);a(b.gain);return b},AudioContext.prototype.hasOwnProperty("createOscillator")&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,
AudioContext.prototype.createOscillator=function(){var b=this.internal_createOscillator();b.start||(b.start=b.noteOn);b.stop||(b.stop=b.noteOff);a(b.frequency);a(b.detune);return b}),AudioContext.prototype.hasOwnProperty("createGain")||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),AudioContext.prototype.hasOwnProperty("createDelay")||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),AudioContext.prototype.hasOwnProperty("createScriptProcessor")||
(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode))})(window);WX=function(){var a=new AudioContext,b=function(){};return Object.create(null,{context:{enumerable:!0,get:function(){return a},set:b},sampleRate:{enumerable:!0,get:function(){return a.sampleRate},set:b},now:{enumerable:!0,get:function(){return a.currentTime},set:b},version:{enumerable:!0,get:function(){return"r8"},set:b}})}();WX._log=function(){function a(a,b,e){a+=b;e&&e.label&&(a+=" ("+e.label+")");return a}var b=!1;return{verbose:function(a){"boolean"===typeof a&&(b=a)},post:function(b){console.log(a("[wx] ",b))},info:function(c,d){b&&console.log(a("[wx:info] ",c,d))},warn:function(c,d){b&&console.log(a("[wx:warn] ",c,d))},error:function(b,d){throw Error(a("[wx:err] ",b,d));}}}();
Object.defineProperties(WX,{PI:{value:Math.PI},TWOPI:{value:2*Math.PI},EPS:{value:Number.MIN_VALUE},NoteName:{value:{A0:21,B0:23,C1:24,D1:26,E1:28,F1:29,G1:31,A1:33,B1:35,C2:36,D2:38,E2:40,F2:41,G2:43,A2:45,B2:47,C3:48,D3:50,E3:52,F3:53,G3:55,A3:57,B3:59,C4:60,D4:62,E4:64,F4:65,G4:67,A4:69,B4:71,C5:72,D5:74,E5:76,F5:77,G5:79,A5:81,B5:83,C6:84,D6:86,E6:88,F6:89,G6:91,A6:93,B6:95,C7:96,D7:98,E7:100,F7:101,G7:103,A7:105,B7:107,C8:108}},random2f:{value:function(a,b){return a+Math.random()*(b-a)}},random2:{value:function(a,
b){return Math.round(a+Math.random()*(b-a))}},pitch2freq:{value:function(a){return 440*Math.pow(2,(Math.floor(a)-69)/12)}},freq2pitch:{value:function(a){return Math.floor(69+12*Math.log(a/440)/Math.log(2))}},lin2db:{value:function(a){return 20*(1E-5<a?Math.log(a)/Math.LN10:-5)}},db2lin:{value:function(a){return Math.pow(10,a/20)}}});
WX._loadBuffer=function(a,b){if(void 0===a||null===a)return WX._log.error("xhr failed (invalid url): "+a),!1;var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){try{var d=WX.context.createBuffer(c.response,!1);b({url:a,buffer:d,status:!0});WX._log.post("loaded: "+a+" ("+d.numberOfChannels+"ch)")}catch(e){WX._log.error("xhr failed ("+e.message+"): "+a)}};c.send();return!0};(function(){WX._builtin={};var a=WX.context.sampleRate,b=10*a,c=new Float32Array(b);WX._builtin.whitenoise=WX.context.createBuffer(1,b,a);for(var d=0;d<b;++d)c[d]=2*Math.random()-1;WX._builtin.whitenoise.getChannelData(0).set(c,0);c=new Float32Array(b);WX._builtin.impulse=WX.context.createBuffer(1,b,a);for(d=c[0]=1;d<b;++d)c[d]=0;WX._builtin.impulse.getChannelData(0).set(c,0);b=new Float32Array(a);WX._builtin.step=WX.context.createBuffer(1,a,a);for(c=0;c<a;++c)b[c]=1;WX._builtin.step.getChannelData(0).set(b,
0)})();WX._unit=function(){return{extend:function(a,b){for(var c in b)a[c]="label"===c?b[c]+"."+a[c]:b[c]},bindAudioParam:function(a,b){var c=this[a+"_"]=b;this[a]=function(a,b,f){if(void 0===a)return c.value;b=b||WX.now;switch(f){case "line":case "l":c.linearRampToValueAtTime(a,b);break;case "expo":case "x":c.exponentialRampToValueAtTime(0===a?1E-4:a,b);break;case "target":case "t":2==b.length&&0<b[1]-b[0]?(f=-(b[1]-b[0])/Math.log(0.0010),c.setTargetValueAtTime(a,b[0],f)):WX._log.warn("invalid timespan for target mode.",
this);break;default:case void 0:c.cancelScheduledValues(b),c.setValueAtTime(a,b)}return this}},bindParam:function(){},factory:function(a){a.map(function(a){WX[a.name]?WX._log.warn("unit name already exists. ("+a.name+")",null):WX[a.name]=function(c){return new a.ref(c)}})}}}();
WX._unit.abstract={_initializeParams:function(a,b){var c={},d;for(d in b)c[d]=b[d];for(var e in a)c[e]=a[e];this.params(c)},params:function(a){if(a)for(var b in a)switch(typeof this[b]){case "function":this[b](a[b]);break;case "number":this[b]=a[b];break;default:case void 0:WX._log.warn("invalid parameters.")}else WX._log.warn("invalid parameter.")},to:function(a){this._outlet.connect(a._inlet);return a},connect:function(a){this._outlet.connect(a)},control:function(a){this._outlet.connect(a)},cut:function(){this._outlet.disconnect()}};
WX._unit.generator=function(){this._active=!0;this._outputGain=WX.context.createGain();this._outlet=WX.context.createGain();this._outputGain.connect(this._outlet);WX._unit.bindAudioParam.call(this,"gain",this._outputGain.gain)};WX._unit.generator.prototype={label:"u.gen",on:function(){this._status=!0;this._outputGain.connect(this._outlet)},off:function(){this._status=!1;this._outputGain.disconnect()}};WX._unit.extend(WX._unit.generator.prototype,WX._unit.abstract);
WX._unit.processor=function(){this._active=!0;this._inlet=WX.context.createGain();this._inputGain=WX.context.createGain();this._outputGain=WX.context.createGain();this._outlet=WX.context.createGain();this._inlet.connect(this._inputGain);this._outputGain.connect(this._outlet);WX._unit.bindAudioParam.call(this,"gain",this._outputGain.gain)};
WX._unit.processor.prototype={label:"u.pro",bypass:function(a){"boolean"===typeof a&&(this._active=!a,a?(this._inlet.disconnect(),this._outputGain.disconnect(),this._inlet.connect(this._outlet)):(this._inlet.disconnect(),this._inlet.connect(this._inputGain),this._outputGain.connect(this._outlet)))}};WX._unit.extend(WX._unit.processor.prototype,WX._unit.abstract);
WX._unit.analyzer=function(){this._active=!0;this._inlet=WX.context.createGain();this._inputGain=WX.context.createGain();this._analyzer=WX.context.createAnalyzer();this._inlet.connect(this._inputGain);this._inputGain.connect(this._analyzer);WX._unit.bindAudioParam.call(this,"inputGain",this._inputGain.gain)};WX._unit.analyzer.prototype={label:"u.ana",on:function(){this._status=!0;this._inlet.connect(this._inputGain)},off:function(){this._status=!1;this._inlet.disconnect()}};WX._unit.oscil=function(a){WX._unit.generator.call(this);this._osc=WX.context.createOscillator();this._osc.connect(this._outputGain);this._osc.start(0);WX._unit.bindAudioParam.call(this,"freq",this._osc.frequency);WX._unit.bindAudioParam.call(this,"detune",this._osc.detune);this._initializeParams(a,this._default)};
WX._unit.oscil.prototype={label:"oscil",_default:{type:"sine",freq:440,gain:1,detune:0},type:function(a){var b;switch(a){case "sine":case "sin":case 0:b=0;break;case "square":case "sqr":case 1:b=1;break;case "sawtooth":case "saw":case 2:b=2;break;case "triangle":case "tri":case 3:b=3;break;case void 0:b=-1}if(-1==b)return this._osc.type;this._osc.type=b},stop:function(a){this._osc.stop(a)}};WX._unit.extend(WX._unit.oscil.prototype,WX._unit.generator.prototype);WX._unit.fmop=function(a){WX._unit.generator.call(this);this._mod=WX.context.createOscillator();this._car=WX.context.createOscillator();this._modGain=WX.context.createGain();this._mod.connect(this._modGain);this._modGain.connect(this._car.frequency);this._car.connect(this._outputGain);this._carFreq=220;this._modIndex=this._harmRatio=1;this._mod.start(0);this._car.start(0);WX._unit.bindAudioParam.call(this,"modFreq",this._mod.frequency);WX._unit.bindAudioParam.call(this,"carFreq",this._car.frequency);
WX._unit.bindAudioParam.call(this,"modDetune",this._mod.detune);WX._unit.bindAudioParam.call(this,"carDetune",this._car.detune);WX._unit.bindAudioParam.call(this,"modGain",this._modGain.gain);this._initializeParams(a,this._default)};
WX._unit.fmop.prototype={label:"fmop",_default:{freq:220,harmRatio:4,modIndex:0.1},freq:function(a,b,c){return void 0!==a?(this._carFreq=a,this.carFreq(a,b,c)):this._carFreq},harmRatio:function(a,b,c){return void 0!==a?(this._harmRatio=a,this.modFreq(this._carFreq*this._harmRatio,b,c)):this._harmRatio},modIndex:function(a,b,c){return void 0!==a?(this._modIndex=a,this.modGain(this._carFreq*this._harmRatio*this._modIndex,b,c)):this._modIndex},stop:function(a){this._mod.stop(a);this._car.stop(a)}};
WX._unit.extend(WX._unit.fmop.prototype,WX._unit.generator.prototype);WX._unit.noise=function(a){WX._unit.generator.call(this);this._noise=WX.context.createBufferSource();this._noise.connect(this._outputGain);this._noise.buffer=WX._builtin.whitenoise;this._noise.loop=1;this._noise.loopStart=Math.random()*this._noise.buffer.duration;this._noise.start(0);WX._unit.bindAudioParam.call(this,"rate",this._noise.playbackRate);this._initializeParams(a,this._default)};WX._unit.noise.prototype={label:"noise",_default:{type:"white",gain:1},type:function(){},stop:function(a){this._noise.stop(a)}};
WX._unit.extend(WX._unit.noise.prototype,WX._unit.generator.prototype);WX._unit.itrain=function(a){WX._unit.generator.call(this);this._impulse=WX.context.createBufferSource();this._impulse.connect(this._outputGain);this._impulse.buffer=WX._builtin.impulse;this._impulse.loop=1;this._frequency=this._impulse.loopEnd=1;this._impulse.start(0);this._initializeParams(a,this._default)};
WX._unit.itrain.prototype={label:"itrain",_default:{gain:1},freq:function(a){return a?(this._frequency=0.1>a?0.1:a,this._impulse.loopEnd=1/this._frequency,this):this._frequency},stop:function(a){this._impulse.stop(a||WX.now)}};WX._unit.extend(WX._unit.itrain.prototype,WX._unit.generator.prototype);WX._unit.fader=function(a){WX._unit.processor.call(this);this._inverter=WX.context.createGain();this._left=WX.context.createGain();this._right=WX.context.createGain();this._merger=WX.context.createChannelMerger(2);this._inputGain.connect(this._inverter);this._inverter.connect(this._left);this._inverter.connect(this._right);this._left.connect(this._merger,0,0);this._right.connect(this._merger,0,1);this._merger.connect(this._outputGain);this._position=0;WX._unit.bindAudioParam.call(this,"inputGain",
this._inputGain.gain);WX._unit.bindAudioParam.call(this,"gainLeft",this._left.gain);WX._unit.bindAudioParam.call(this,"gainRight",this._right.gain);this._initializeParams(a,this._default)};
WX._unit.fader.prototype={label:"fader",_default:{panner:0.5,gain:1},db:function(a,b,c){return void 0!==a?this.gain(WX.db2lin(a),b,c):WX.lin2db(this.gain())},mute:function(a,b){return"boolean"===typeof a?this.inputGain(a?0:1,b):0===this.inputGain()?!0:!1},invert:function(a,b){return"boolean"===typeof a?(this._inverter.gain.setValueAtTime(a?-1:1,b||WX.now),this):-1==this._inverter.gain.value?!0:!1},panner:function(a,b,c){return void 0!==a?(this._position=a=Math.min(1,Math.max(0,a)),this.gainLeft(Math.sqrt(a),
b,c),this.gainRight(Math.sqrt(1-a),b,c),this):this._position}};WX._unit.extend(WX._unit.fader.prototype,WX._unit.processor.prototype);WX._unit.filter=function(a){WX._unit.processor.call(this);this._filter=WX.context.createBiquadFilter();this._inputGain.connect(this._filter);this._filter.connect(this._outputGain);this._filter.type="lowpass";WX._unit.bindAudioParam.call(this,"cutoff",this._filter.frequency);WX._unit.bindAudioParam.call(this,"Q",this._filter.Q);WX._unit.bindAudioParam.call(this,"detune",this._filter.detune);WX._unit.bindAudioParam.call(this,"gain",this._filter.gain);this._initializeParams(a,this._default)};
WX._unit.filter.prototype={label:"filter",_default:{cutoff:1E3,Q:1},type:function(a){return void 0!==a?(this._filter.type=a,this):this._filter.type}};WX._unit.extend(WX._unit.filter.prototype,WX._unit.processor.prototype);WX._unit.comp=function(a){WX._unit.processor.call(this);this._comp=WX.context.createDynamicsCompressor();this._inputGain.connect(this._comp);this._comp.connect(this._outputGain);WX._unit.bindAudioParam.call(this,"inputGain",this._inputGain.gain);WX._unit.bindAudioParam.call(this,"threshold",this._comp.threshold);WX._unit.bindAudioParam.call(this,"knee",this._comp.knee);WX._unit.bindAudioParam.call(this,"ratio",this._comp.ratio);WX._unit.bindAudioParam.call(this,"attack",this._comp.attack);WX._unit.bindAudioParam.call(this,
"release",this._comp.release);this._initializeParams(a,this._default)};WX._unit.comp.prototype={label:"comp",_default:{threshold:-24,knee:0,ratio:4,attack:0.0030,release:0.25,gain:1},makeup:function(a,b,c){a=WX.db2lin(a);this.gain(a,b,c)}};WX._unit.extend(WX._unit.comp.prototype,WX._unit.processor.prototype);WX._unit.pingpong=function(a){WX._unit.processor.call(this);this._delayL=WX.context.createDelay();this._delayR=WX.context.createDelay();this._fbL=WX.context.createGain();this._fbR=WX.context.createGain();this._crosstalkL=WX.context.createGain();this._crosstalkR=WX.context.createGain();this._merger=WX.context.createChannelMerger(2);this._dry=WX.context.createGain();this._wet=WX.context.createGain();this._inputGain.connect(this._delayL);this._inputGain.connect(this._delayR);this._inputGain.connect(this._dry);
this._delayL.connect(this._fbL);this._delayR.connect(this._fbR);this._fbL.connect(this._delayL);this._fbR.connect(this._delayR);this._fbL.connect(this._crosstalkR);this._fbR.connect(this._crosstalkL);this._crosstalkR.connect(this._delayR);this._crosstalkL.connect(this._delayL);this._delayL.connect(this._merger,0,0);this._delayR.connect(this._merger,0,1);this._merger.connect(this._wet);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);WX._unit.bindAudioParam.call(this,"delayTimeLeft",
this._delayL.delayTime);WX._unit.bindAudioParam.call(this,"delayTimeRight",this._delayR.delayTime);WX._unit.bindAudioParam.call(this,"feedbackLeft",this._fbL.gain);WX._unit.bindAudioParam.call(this,"feedbackRight",this._fbR.gain);WX._unit.bindAudioParam.call(this,"crosstalkLeft",this._crosstalkL.gain);WX._unit.bindAudioParam.call(this,"crosstalkRight",this._crosstalkR.gain);WX._unit.bindAudioParam.call(this,"dry",this._dry.gain);WX._unit.bindAudioParam.call(this,"wet",this._wet.gain);this._initializeParams(a,
this._default)};
WX._unit.pingpong.prototype={label:"pingpong",_default:{delayTimeLeft:0.125,delayTimeRight:0.25,feedback:0.25,crosstalk:0.1,mix:0.5},delayTime:function(a,b,c){return void 0!==a?this.delayTimeLeft(a,b,c).delayTimeRight(a,b,c):[this.delayTimeLeft(),this.delayTimeRight()]},crosstalk:function(a,b,c){return void 0!==a?this.crosstalkLeft(a,b,c).crosstalkRight(a,b,c):[this.crosstalkLeft(),this.crosstalkRight()]},feedback:function(a,b,c){return void 0!==a?this.feedbackLeft(a,b,c).feedbackRight(a,b,c):[this.feedbackLeft(),
this.feedbackRight()]},mix:function(a,b,c){return void 0!==a?this.dry(1-a,b,c).wet(a,b,c):this.wet()}};WX._unit.extend(WX._unit.pingpong.prototype,WX._unit.processor.prototype);WX._unit.converb=function(a){WX._unit.processor.call(this);this._convolver=WX.context.createConvolver();this._dry=WX.context.createGain();this._wet=WX.context.createGain();this._inputGain.connect(this._convolver);this._inputGain.connect(this._dry);this._convolver.connect(this._wet);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);this._ready=!1;this._url=null;var b=this;this._oncomplete=function(a){b._url=a.url;b._convolver.buffer=a.buffer;b._ready=a.status};WX._unit.bindAudioParam.call(this,
"dry",this._dry.gain);WX._unit.bindAudioParam.call(this,"wet",this._wet.gain);this._initializeParams(a,this._default)};WX._unit.converb.prototype={label:"converb",_default:{source:"../data/ir/hall.wav",mix:0.1},source:function(a){if(a)WX._loadBuffer(a,this._oncomplete);else return this._url},mix:function(a,b,c){return void 0!==a?(this.dry(1-a,b,c),this.wet(a,b,c)):this.wet()}};WX._unit.extend(WX._unit.converb.prototype,WX._unit.processor.prototype);(function(){WX._log.post("waax ("+WX.version+")");WX._log.verbose(!0);WX._unit.factory([{name:"Oscil",ref:WX._unit.oscil},{name:"Fmop",ref:WX._unit.fmop},{name:"Noise",ref:WX._unit.noise},{name:"ITrain",ref:WX._unit.itrain},{name:"Sampler",ref:WX._unit.sampler},{name:"Step",ref:WX._unit.step},{name:"Fader",ref:WX._unit.fader},{name:"ADSR",ref:WX._unit.adsr},{name:"Filter",ref:WX._unit.filter},{name:"Pingpong",ref:WX._unit.pingpong},{name:"Comp",ref:WX._unit.comp},{name:"Converb",ref:WX._unit.converb}]);
WX.DAC=WX.Fader();WX.DAC.connect(WX.context.destination);WX._log.info("master fader created. (WX.DAC)")})();
