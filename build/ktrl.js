!function(){if("undefined"==typeof navigator.requestMIDIAccess)throw new Error("[Ktrl] your browser does not support Web MIDI API. Halt.")}(),Ktrl=function(){function a(a){this.input=a,this.targets=[];var b=this;this.input.onmidimessage=function(a){for(var c=b.targets.length;c--;)b.targets[c].ondata(a)}}function b(a){this.id=m++,this.label=a||"Untitled",this.active=!1,this.process=function(){};var b=this;this.ondata=function(a){b.active&&b.process(a)},l.push(this)}function c(a){return new b(a)}function d(a){return k.map(function(b){b.addTarget(a)}),!0}function e(a,b){return a<k.length?(k.map(function(a){a.removeTarget(b)}),k[a].addTarget(b),!0):(j("invalid source id or target."),!1)}function f(a){return k.map(function(b){b.removeTarget(a)}),!0}function g(a){return Ktrl.disconnectTarget(a)?(l.map(function(b){if(b===a){var c=l.indexOf(a);l.splice(c,1)}}),!0):!1}function h(a){"function"!=typeof a?j("invalid handler function."):n=a}function i(){var a=0;j("listing available MIDI Input Ports..."),k.map(function(b){console.log(b.input.type,a++,"	",b.input.name,"	",b.input.manufacturer)}),j("listing available MIDI targets..."),l.map(function(a){console.log("id "+a.id,"	",a.label,"	",a.active)})}function j(a){console.log("[ktrl] "+a)}var k=[],l=[],m=0,n=null,o=!1,p="r1";return a.prototype={constructor:a,removeTarget:function(a){var b=this;this.targets.map(function(c){if(c===a){var d=b.targets.indexOf(a);b.targets.splice(d,1)}})},addTarget:function(a){for(var b=0;b<this.targets.length;++b)if(this.targets[b]===a)return void j("duplicate target.");this.targets.push(a)}},b.prototype={constructor:b,onData:function(a){this.process=a},activate:function(){this.active=!0},disable:function(){this.active=!1},getID:function(){return this.id}},parse=function(a){var b,c=a.data,d=c[0]>>4,e=(15&c[0])+1;switch(d){case 8:b={type:"noteoff",channel:e,pitch:c[1],velocity:c[2]};break;case 9:b={type:"noteon",channel:e,pitch:c[1],velocity:c[2]};break;case 10:b={type:"polypressure",channel:e,pitch:c[1],pressure:c[2]};break;case 11:b={type:"controlchange",channel:e,control:c[1],value:c[2]};break;case 12:b={type:"programchange",channel:e,program:c[1]};break;case 13:b={type:"channelpressure",channel:e,pressure:c[1]};break;case 14:b={type:"pitchwheel",channel:e,wheel:c[1]<<8|c[2]}}return b},navigator.requestMIDIAccess().then(function(b){if(0===b.inputs().length)return void j("no input ports available");for(var c=0;c<b.inputs().length;++c)k[c]=new a(b.inputs()[c]);j("Ktrl ("+p+") is ready."),o=!0,"function"==typeof n?n():j("onReady is not specified.")},function(a){j("failed to get MIDI access: "+a),o=!1}),{createTarget:c,removeTarget:g,disconnectTarget:f,routeAllToTarget:d,routeSourceToTarget:e,ready:h,parse:parse,report:i}}();
//# sourceMappingURL=waax.map