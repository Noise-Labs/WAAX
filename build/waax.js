window.WX=function(){"use strict";function Envelope(){var args=arguments;return function(startTime){var env=[];startTime=startTime||0;for(var i=0;i<args.length;i++){var time,val=args[i][0];Util.isArray(args[i][1])?(time=[startTime+args[i][1][0],startTime+args[i][1][1]],env.push([val,time,3])):(time=startTime+args[i][1],env.push([val,time,args[i][2]||0]))}return env}}function Param(options){this.type=options.type||"number","enum"===this.type&&(this.items=options.items),this.default=options.default,this.min=options.min,this.max=options.max,this.target=options.target,this.init()}function loadClip(clip,onprogress,oncomplete){var xhr=new XMLHttpRequest;xhr.open("GET",clip.url,!0),xhr.responseType="arraybuffer",xhr.onprogress=function(event){onprogress(clip.name,event)},xhr.onload=function(){try{Core.context.decodeAudioData(xhr.response,function(buffer){clip.buffer=buffer}),oncomplete()}catch(error){Info.error("Loading clip failed. (XHR failure)",error.message,clip.url)}},xhr.send()}var Info=function(){var api_version="0.0.1-alpha";return{getVersion:function(){return api_version}}}(),Log=function(){var logLevel=1,_c=window.console;return{setLevel:function(level){logLevel=level},info:function(){if(!(logLevel>1)){var args=Array.prototype.slice.call(arguments);args.unshift("[WX:info]"),_c.log.apply(_c,args)}},warn:function(){if(!(logLevel>2)){var args=Array.prototype.slice.call(arguments);args.unshift("[WX:warn]"),_c.log.apply(_c,args)}},error:function(){var args=Array.prototype.slice.call(arguments);throw args.unshift("[WX:error]"),_c.log.apply(_c,args),new Error("[WX:error]")}}}(),Util=function(){var LOG2=Math.LN2,LOG10=Math.LN10,MIDI1499=3.282417553401589e38;return{isObject:function(obj){return obj===Object(obj)},isArray:function(arr){return"[object Array]"===toString.call(arr)},isNumber:function(num){return"[object Number]"===toString.call(num)},hasParam:function(unit,param){return hasOwnProperty.call(unit.preset,param)},extend:function(target,source){for(var prop in source)target[prop]||(target[prop]=source[prop]);return target},clone:function(source){var obj={};for(var prop in source)obj[prop]=source[prop];return obj},clamp:function(value,min,max){return Math.min(Math.max(value,min),max)},random2f:function(min,max){return min+Math.random()*(max-min)},random2:function(min,max){return Math.round(min+Math.random()*(max-min))},mtof:function(midi){return-1500>=midi?0:midi>1499?MIDI1499:440*Math.pow(2,(Math.floor(midi)-69)/12)},ftom:function(freq){return Math.floor(freq>0?Math.log(freq/440)/LOG2*12+69:-1500)},powtodb:function(pow){if(0>=pow)return 0;var db=100+10/LOG10*Math.log(pow);return 0>db?0:db},dbtopow:function(db){return 0>=db?0:(db>870&&(db=870),Math.exp(.1*LOG10*(db-100)))},rmstodb:function(rms){if(0>=rms)return 0;var db=100+20/LOG10*Math.log(rms);return 0>db?0:db},dbtorms:function(db){return 0>=db?0:(db>485&&(db=485),Math.exp(.05*LOG10*(db-100)))},lintodb:function(lin){return 20*(lin>1e-5?Math.log(lin)/LOG10:-5)},dbtolin:function(db){return Math.pow(10,db/20)},patch:function(){for(var i=0,last=arguments.length-1;last>i;i++)arguments[i]._outlet.connect(arguments[i+1]._inlet)}}}();window.hasOwnProperty("webkitAudioContext")||window.hasOwnProperty("AudioContext")?window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext):Log.error("Web Audio API is not supported. See http://caniuse.com/audio-api for more info.");var Core=function(){var ctx=new AudioContext;return{context:ctx,Gain:function(){return ctx.createGain()},OSC:function(){return ctx.createOscillator()},Delay:function(){return ctx.createDelay()},Filter:function(){return ctx.createBiquadFilter()},Comp:function(){return ctx.createDynamicsCompressor()},Convolver:function(){return ctx.createConvolver()},WaveShaper:function(){return ctx.createWaveShaper()},Source:function(){return ctx.createBufferSource()},Analyzer:function(){return ctx.createAnalyser()},Panner:function(){return ctx.createPanner()},Splitter:function(){return ctx.createChannelSplitter.apply(ctx,arguments)},Merger:function(){return ctx.createChannelMerger.apply(ctx,arguments)},Buffer:function(){return ctx.createBuffer.apply(ctx,arguments)}}}();Param.prototype={init:function(){switch(this.type){case"bool":this.set=this._setBool;break;case"number":this.set=this._setNumber;break;case"enum":this.set=this._setEnum,this.get=this._getEnum}this.set(this.default,0,0)},get:function(){return this.target.value},set:null,_setBool:function(val){val=val?this.max:this.min,this.target.setValueAtTime(val,0)},_setNumber:function(val,time,xType){switch(val=Math.min(Math.max(val,this.min),this.max),xType){case 0:this.target.setValueAtTime(val,time);break;case 1:this.target.linearRampToValueAtTime(val,time);break;case 2:val=0>=val?1e-5:val,this.target.exponentialRampToValueAtTime(val,time);break;case 3:val=0>=val?1e-5:val,this.target.setTargetAtTime(val,time[0],time[1])}},_setEnum:function(val){return this.items.indexOf(val)>-1?void(this.target=val):null},_getEnum:function(){return this.target}};var Plugin=function(){function addModule(unit,modules){BaseModule.call(unit),modules.indexOf("input")>-1&&InputModule.call(unit),modules.indexOf("output")>-1&&OutputModule.call(unit)}function addParam(unit,paramName,option){unit.params[paramName]=new Param(option)}function initializePreset(unit,preset){Util.extend(unit.preset,unit.defaultPreset),Util.extend(unit.preset,preset),unit.setPreset(unit.preset)}function addPrototype(unit,modules){Util.extend(unit.prototype,BaseModule.prototype),modules.indexOf("input")>-1&&Util.extend(unit.prototype,InputModule.prototype),modules.indexOf("output")>-1&&Util.extend(unit.prototype,OutputModule.prototype)}function register(Constructor){var i=Constructor.prototype.info;Info.getVersion()>i.api_version&&Log.error(Constructor.name,": loading failed. incompatible WAAX version."),window.WX[Constructor.name]=function(preset){return new Constructor(preset)}}var BaseModule=function(){this._active=Core.Gain(),this.preset={active:!0},this.params={active:new Param({type:"bool","default":!0,min:0,max:1,target:this._active.gain})}};BaseModule.prototype={set:function(param,arg){if(Util.hasParam(this,param))if(Util.isArray(arg)){for(var i=0;i<arg.length;i++)this["$"+param].apply(this,arg[i]);this.preset[param]=arg[arg.length-1][0]}else this["$"+param].apply(this,[arg,0,0]),this.preset[param]=arg;return this},get:function(param){return Util.hasParam(this,param)?this.preset[param]:null},setPreset:function(preset){for(var param in preset)this.set(param,preset[param])},getPreset:function(){return Util.clone(this.preset)},$active:function(val){this.params.active.set(val)}};var InputModule=function(){this._inlet=Core.Gain(),this._input=Core.Gain(),this._bypass=Core.Gain(),this.preset.inputGain=1,this.params.inputGain=new Param({type:"number","default":1,min:0,max:1,target:this._input.gain}),this._inlet.connect(this._input),this._inlet.connect(this._bypass)};InputModule.prototype={$inputGain:function(val,time,xType){this.params.inputGain.set(val,time,xType)}};var OutputModule=function(){this._output=Core.Gain(),this._outlet=Core.Gain(),this.preset.gain=1,this.params.gain=new Param({type:"number","default":1,min:0,max:1,target:this._output.gain}),this._output.connect(this._active),this._active.connect(this._outlet)};return OutputModule.prototype={to:function(unit){return unit._inlet?(this._outlet.connect(unit._inlet),unit):void Log.error("invalid patching.")},connect:function(node){this._outlet.connect(node)},$gain:function(val,time,xType){this.params.gain.set(val,time,xType)}},{addModule:addModule,addParam:addParam,initializePreset:initializePreset,addPrototype:addPrototype,register:register}}();return function(){Log.info("WAAX",Info.getVersion(),"("+Core.context.sampleRate+"Hz)")}(),{Info:Info,Log:Log,isObject:Util.isObject,isArray:Util.isArray,isNumber:Util.isNumber,hasParam:Util.hasParam,extend:Util.extend,clone:Util.clone,clamp:Util.clamp,random2f:Util.random2f,random2:Util.random2,mtof:Util.mtof,ftom:Util.ftom,powtodb:Util.powtodb,dbtopow:Util.dbtopow,rmstodb:Util.rmstodb,dbtorms:Util.dbtorms,lintodb:Util.lintodb,dbtolin:Util.dbtolin,patch:Util.patch,Envelope:Envelope,Param:Param,loadClip:loadClip,context:Core.context,get now(){return Core.context.currentTime},get srate(){return Core.context.sampleRate},Gain:Core.Gain,OSC:Core.OSC,Delay:Core.Delay,Filter:Core.Filter,Comp:Core.Comp,Convolver:Core.Convolver,WaveShaper:Core.WaveShaper,Source:Core.Source,Analyzer:Core.Analyzer,Panner:Core.Panner,Splitter:Core.Splitter,Merger:Core.Merger,Buffer:Core.Buffer,Plugin:Plugin}}(),function(WX){function Fader(preset){WX.Plugin.addModule(this,["input","output"]),this._input.connect(this._output),WX.Plugin.initializePreset(this,preset)}Fader.prototype={info:{name:"Fader",api_version:"0.0.1-alpha",plugin_version:"0.0.1",author:"hoch",type:"effect",description:"a channel fader"},defaultPreset:{mute:!1,dB:0},$active:function(val){this.preset.mute=!val,this.params.active.set(val)},$gain:function(val,time,xType){this.preset.dB=WX.lintodb(val),this.params.gain.set(val,time,xType)},$mute:function(val){this.set("active",!val)},$dB:function(val,time,xType){this.set("gain",[[WX.dbtolin(val),time,xType]])}},WX.Plugin.addPrototype(Fader,["input","output"]),WX.Plugin.register(Fader),WX.Master=WX.Fader(),WX.Master.connect(WX.context.destination)}(WX);
//# sourceMappingURL=waax.map