window.WX=function(){"use strict";var Info=function(){var api_version="1.0.0-alpha";return{getVersion:function(){return api_version}}}(),Log=function(){var logLevel=1,_c=window.console;return{setLevel:function(level){logLevel=level},info:function(){if(!(logLevel>1)){var args=Array.prototype.slice.call(arguments);args.unshift("[WX:info]"),_c.log.apply(_c,args)}},warn:function(){if(!(logLevel>2)){var args=Array.prototype.slice.call(arguments);args.unshift("[WX:warn]"),_c.log.apply(_c,args)}},error:function(){var args=Array.prototype.slice.call(arguments);throw args.unshift("[WX:error]"),_c.log.apply(_c,args),new Error("[WX:error]")}}}(),Util=function(){var LOG2=Math.LN2,LOG10=Math.LN10,MIDI1499=3.282417553401589e38;return{isObject:function(obj){return obj===Object(obj)},isFunction:function(fn){return"[object Function]"===toString.call(fn)},isArray:function(arr){return"[object Array]"===toString.call(arr)},isNumber:function(num){return"[object Number]"===toString.call(num)},isBoolean:function(bool){return"[object Boolean]"===toString.call(bool)},hasParam:function(plugin,param){return hasOwnProperty.call(plugin.params,param)},extend:function(target,source){for(var prop in source)target[prop]=source[prop];return target},clone:function(source){var obj={};for(var prop in source)obj[prop]=source[prop];return obj},validateModel:function(model){if(0===model.length)return!1;for(var keys=[],i=0;i<model.length;i++){if(keys.indexOf(model[i].key)>-1)return!1;keys.push(model[i].key)}return!0},findKeyByValue:function(model,value){for(var i=0;i<model.length;i++)if(model[i].value===value)return model[i].key;return null},findValueByKey:function(model,key){for(var i=0;i<model.length;i++)if(model[i].key===key)return model[i].value;return null},clamp:function(value,min,max){return Math.min(Math.max(value,min),max)},random2f:function(min,max){return min+Math.random()*(max-min)},random2:function(min,max){return Math.round(min+Math.random()*(max-min))},mtof:function(midi){return-1500>=midi?0:midi>1499?MIDI1499:440*Math.pow(2,(Math.floor(midi)-69)/12)},ftom:function(freq){return Math.floor(freq>0?Math.log(freq/440)/LOG2*12+69:-1500)},powtodb:function(pow){if(0>=pow)return 0;var db=100+10/LOG10*Math.log(pow);return 0>db?0:db},dbtopow:function(db){return 0>=db?0:(db>870&&(db=870),Math.exp(.1*LOG10*(db-100)))},rmstodb:function(rms){if(0>=rms)return 0;var db=100+20/LOG10*Math.log(rms);return 0>db?0:db},dbtorms:function(db){return 0>=db?0:(db>485&&(db=485),Math.exp(.05*LOG10*(db-100)))},lintodb:function(lin){return 20*(lin>1e-5?Math.log(lin)/LOG10:-5)},dbtolin:function(db){return Math.pow(10,db/20)},veltoamp:function(velocity){return velocity/127}}}();window.hasOwnProperty("webkitAudioContext")||window.hasOwnProperty("AudioContext")?window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext):Log.error("Web Audio API is not supported. See http://caniuse.com/audio-api for more info.");var Core=function(){function Envelope(){var args=arguments;return function(startTime,amplifier){var env=[];startTime=startTime||0,amplifier=amplifier||1;for(var i=0;i<args.length;i++){var time,val=args[i][0];Util.isArray(args[i][1])?(time=[startTime+args[i][1][0],startTime+args[i][1][1]],env.push([val*amplifier,time,3])):(time=startTime+args[i][1],env.push([val*amplifier,time,args[i][2]||0]))}return env}}function checkNumeric(arg,def){return Util.isNumber(arg)?arg:void 0===arg?def:void Info.error("Invalid parameter configuration")}function GenericParam(options){this.init(options)}function ItemizedParam(options){this.init(options)}function BooleanParam(options){this.init(options)}function createParam(options){switch(types.indexOf(options.type)<0&&Log.error("Invalid Parameter Type."),options.type){case"Generic":return new GenericParam(options);case"Itemized":return new ItemizedParam(options);case"Boolean":return new BooleanParam(options)}}function loadClip(clip,onprogress,oncomplete){var xhr=new XMLHttpRequest;xhr.open("GET",clip.url,!0),xhr.responseType="arraybuffer",xhr.onprogress=function(event){onprogress(event,clip)},xhr.onload=function(){try{Core.ctx.decodeAudioData(xhr.response,function(buffer){clip.buffer=buffer,oncomplete(clip)})}catch(error){Info.error("Loading clip failed. (XHR failure)",error.message,clip.url)}},xhr.send()}var ctx=new AudioContext;AudioNode.prototype.to=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i]);return arguments[0]},AudioNode.prototype.cut=function(){this.disconnect()};var WAP=window.AudioParam.prototype;WAP.cancel=WAP.cancelScheduledValues,WAP.set=function(value,time,rampType){switch(rampType){case 0:case void 0:time=time<ctx.currentTime?ctx.currentTime:time,this.setValueAtTime(value,time);break;case 1:time=time<ctx.currentTime?ctx.currentTime:time,this.linearRampToValueAtTime(value,time);break;case 2:time=time<ctx.currentTime?ctx.currentTime:time,value=0>=value?1e-5:value,this.exponentialRampToValueAtTime(value,time);break;case 3:time[0]=time[0]<ctx.currentTime?ctx.currentTime:time[0],value=0>=value?1e-5:value,this.setTargetAtTime(value,time[0],time[1])}};var types=["Generic","Itemized","Boolean"];return GenericParam.prototype={init:function(options){this.type="Generic",this.name=options.name||"Parameter",this.unit=options.unit||"",this.value=this.default=checkNumeric(options.default,0),this.min=checkNumeric(options.min,0),this.max=checkNumeric(options.max,1),this._parent=options._parent,this.$callback=options._parent["$"+options._paramId]},set:function(value,time,rampType){this.value=Util.clamp(value,this.min,this.max),this.$callback&&this.$callback.call(this._parent,this.value,time,rampType)},get:function(){return this.value}},ItemizedParam.prototype={init:function(options){Util.isArray(options.model)||Log.error("Model is missing."),Util.validateModel(options.model)||Log.error("Invalid Model."),this.type="Itemized",this.name=options.name||"Select",this.model=options.model,this.default=options.default||this.model[0].value,this.value=this.default,this._parent=options._parent,this.$callback=options._parent["$"+options._paramId]},set:function(value,time,rampType){Util.findKeyByValue(this.model,value)&&(this.value=value,this.$callback&&this.$callback.call(this._parent,this.value,time,rampType))},get:function(){return this.value},getModel:function(){return this.model}},BooleanParam.prototype={init:function(options){Util.isBoolean(options.default)||Log.error("Invalid value for Boolean Parameter."),this.parent=options.parent,this.type="Boolean",this.name=options.name||"Toggle",this.default=options.default||!1,this.value=this.default,this._parent=options._parent,this.$callback=options._parent["$"+options._paramId]},set:function(value,time,rampType){Util.isBoolean(value)&&(this.value=value,this.$callback&&this.$callback.call(this._parent,this.value,time,rampType))},get:function(){return this.value}},{ctx:ctx,Gain:function(){return ctx.createGain()},OSC:function(){return ctx.createOscillator()},Delay:function(){return ctx.createDelay()},Filter:function(){return ctx.createBiquadFilter()},Comp:function(){return ctx.createDynamicsCompressor()},Convolver:function(){return ctx.createConvolver()},WaveShaper:function(){return ctx.createWaveShaper()},Source:function(){return ctx.createBufferSource()},Analyzer:function(){return ctx.createAnalyser()},Panner:function(){return ctx.createPanner()},PeriodicWave:function(){return ctx.createPeriodicWave.apply(ctx,arguments)},Splitter:function(){return ctx.createChannelSplitter.apply(ctx,arguments)},Merger:function(){return ctx.createChannelMerger.apply(ctx,arguments)},Buffer:function(){return ctx.createBuffer.apply(ctx,arguments)},Envelope:Envelope,defineParams:function(plugin,paramOptions){for(var key in paramOptions)paramOptions[key]._parent=plugin,paramOptions[key]._paramId=key,plugin.params[key]=createParam(paramOptions[key])},loadClip:loadClip}}(),Plugin=function(){function PluginAbstract(){this.params={}}function GeneratorAbstract(){PluginAbstract.call(this),this._output=Core.Gain(),this._outlet=Core.Gain(),this._output.to(this._outlet),Core.defineParams(this,{output:{type:"Generic",name:"Output","default":1,min:0,max:1,unit:"LinearGain"}})}function ProcessorAbstract(){PluginAbstract.call(this),this._inlet=Core.Gain(),this._input=Core.Gain(),this._output=Core.Gain(),this._active=Core.Gain(),this._bypass=Core.Gain(),this._outlet=Core.Gain(),this._inlet.to(this._input,this._bypass),this._output.to(this._active).to(this._outlet),this._bypass.to(this._outlet),Core.defineParams(this,{input:{type:"Generic",unit:"LinearGain","default":1,min:0,max:1},output:{type:"Generic",unit:"LinearGain","default":1,min:0,max:1},bypass:{type:"Boolean","default":!1}})}function AnalyzerAbstract(){PluginAbstract.call(this),this._inlet=Core.Gain(),this._input=Core.Gain(),this._outlet=Core.Gain(),this._inlet.to(this._input),this._inlet.to(this._outlet),Core.defineParams(this,{input:{type:"Generic",unit:"LinearGain","default":1,min:0,max:1}})}var types=["Generator","Processor","Analyzer"];return PluginAbstract.prototype={set:function(param,arg){if(Util.hasParam(this,param))if(Util.isArray(arg))for(var i=0;i<arg.length;i++)this.params[param].set.apply(this,arg[i]);else this.params[param].set(arg,Core.ctx.currentTime,0);return this},get:function(param){return Util.hasParam(this,param)?this.params[param].get():null},setPreset:function(preset){for(var param in preset)this.params[param].set(preset[param],Core.ctx.currentTime,0)},getPreset:function(){var preset={};for(var param in this.params)preset[param]=this.params[param].get();return preset}},GeneratorAbstract.prototype={to:function(input){if(input._inlet)return this._outlet.to(input._inlet),input;try{return this._outlet.to(input),input}catch(error){Log.error("Connection failed. Invalid patching.")}},cut:function(){this._outlet.cut()},$output:function(value,time,xtype){this._output.gain.set(value,time,xtype)}},Util.extend(GeneratorAbstract.prototype,PluginAbstract.prototype),ProcessorAbstract.prototype={$input:function(value,time,xtype){this._input.gain.set(value,time,xtype)},$bypass:function(value,time,xtype){value?(this._active.gain.set(0,time,xtype),this._bypass.gain.set(1,time,xtype)):(this._active.gain.set(1,time,xtype),this._bypass.gain.set(0,time,xtype))}},Util.extend(ProcessorAbstract.prototype,GeneratorAbstract.prototype),AnalyzerAbstract.prototype={to:function(input){if(input._inlet)return this._outlet.to(input._inlet),input;try{return this._outlet.to(input),input}catch(error){Log.error("Connection failed. Invalid patching.")}},cut:function(){this._outlet.cut()},$input:function(value,time,xtype){this._input.gain.set(value,time,xtype)}},Util.extend(AnalyzerAbstract.prototype,PluginAbstract.prototype),{defineType:function(plugin,type){switch(types.indexOf(type)<0&&Log.error("Invalid Plug-in type."),type){case"Generator":GeneratorAbstract.call(plugin);break;case"Processor":ProcessorAbstract.call(plugin);break;case"Analyzer":AnalyzerAbstract.call(plugin)}},initPreset:function(plugin,preset){var merged=Util.clone(plugin.defaultPreset);Util.extend(merged,preset),plugin.setPreset(merged)},extendPrototype:function(plugin,type){switch(types.indexOf(type)<0&&Log.error("Invalid Plug-in type."),type){case"Generator":Util.extend(plugin.prototype,GeneratorAbstract.prototype);break;case"Processor":Util.extend(plugin.prototype,ProcessorAbstract.prototype);break;case"Analyzer":Util.extend(plugin.prototype,AnalyzerAbstract.prototype)}},register:function(PluginConstructor){var i=PluginConstructor.prototype.info;Info.getVersion()>i.api_version&&Log.error(PluginConstructor.name,": loading failed. incompatible WAAX version."),window.WX[PluginConstructor.name]=function(preset){return new PluginConstructor(preset)}}}}();return function(){Log.info("WAAX",Info.getVersion(),"("+Core.ctx.sampleRate+"Hz)")}(),{Info:Info,Log:Log,isObject:Util.isObject,isFunction:Util.isFunction,isArray:Util.isArray,isNumber:Util.isNumber,isBoolean:Util.isBoolean,hasParam:Util.hasParam,extend:Util.extend,clone:Util.clone,clamp:Util.clamp,random2f:Util.random2f,random2:Util.random2,mtof:Util.mtof,ftom:Util.ftom,powtodb:Util.powtodb,dbtopow:Util.dbtopow,rmstodb:Util.rmstodb,dbtorms:Util.dbtorms,lintodb:Util.lintodb,dbtolin:Util.dbtolin,veltoamp:Util.veltoamp,context:Core.ctx,get now(){return Core.ctx.currentTime},get srate(){return Core.ctx.sampleRate},Gain:Core.Gain,OSC:Core.OSC,Delay:Core.Delay,Filter:Core.Filter,Comp:Core.Comp,Convolver:Core.Convolver,WaveShaper:Core.WaveShaper,Source:Core.Source,Analyzer:Core.Analyzer,Panner:Core.Panner,Splitter:Core.Splitter,Merger:Core.Merger,Buffer:Core.Buffer,Envelope:Core.Envelope,defineParams:Core.defineParams,loadClip:Core.loadClip,Plugin:Plugin}}(),window.MUI=function(){function MouseResponder(senderID,targetElement,MUICallback){this.senderId=senderID,this.container=targetElement,this.callback=MUICallback,this.ondragged=this.dragged.bind(this),this.onreleased=this.released.bind(this),this._prevTS=0,this.onclicked(targetElement)}function KeyResponder(senderID,targetElement,MUICallback){this.senderId=senderID,this.container=targetElement,this.callback=MUICallback,this.onkeypress=this.keypressed.bind(this),this.onblur=this.finished.bind(this),this.onfocus(targetElement)}return MouseResponder.prototype={getEventData:function(event){var r=this.container.getBoundingClientRect();return{x:event.clientX-r.left,y:event.clientY-r.top,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey}},onclicked:function(target){target.addEventListener("mousedown",function(event){event.preventDefault(),this._prevTS=event.timeStamp;var p=this.getEventData(event);this.callback(this.senderId,"clicked",p),window.addEventListener("mousemove",this.ondragged,!1),window.addEventListener("mouseup",this.onreleased,!1)}.bind(this),!1)},dragged:function(event){if(event.preventDefault(),!(event.timeStamp-this._prevTS<16.7)){this._prevTS=event.timeStamp;var p=this.getEventData(event);this.callback(this.senderId,"dragged",p)}},released:function(event){event.preventDefault();var p=this.getEventData(event);this.callback(this.senderId,"released",p),window.removeEventListener("mousemove",this.ondragged,!1),window.removeEventListener("mouseup",this.onreleased,!1)}},KeyResponder.prototype={onfocus:function(){this.container.addEventListener("mousedown",function(event){event.preventDefault(),this.callback(this.senderId,"clicked",null),this.container.addEventListener("keypress",this.onkeypress,!1),this.container.addEventListener("blur",this.onblur,!1)}.bind(this),!1)},keypressed:function(event){this.callback(this.senderId,"keypressed",event.keyCode)},finished:function(){this.callback(this.senderId,"finished",null),this.container.removeEventListener("keypress",this.onkeypress,!1),this.container.removeEventListener("blur",this.onblur,!1)}},{clamp:function(value,min,max){return Math.max(Math.min(value,max),min)},clone:function(obj){var cloned={};for(var p in obj)obj.hasOwnProperty(p)&&(cloned[p]=obj[p]);return obj},findValueByKey:function(collection,key){for(var i=0;i<collection.length;i++)if(collection[i].key===key)return collection[i].value;return collection[0].value},findKeyByValue:function(collection,value){for(var i=0;i<collection.length;i++)if(collection[i].value===value)return collection[i].key},MouseResponder:function(senderID,targetElement,MUICallback){return new MouseResponder(senderID,targetElement,MUICallback)},KeyResponder:function(senderID,targetElement,MUICallback){return new KeyResponder(senderID,targetElement,MUICallback)},buildControls:function(plugin,targetId){var targetEl=document.getElementById(targetId);for(var param in plugin.params){var p=plugin.params[param];switch(p.type){case"Generic":var knob=document.createElement("mui-knob");knob.link(plugin,param),targetEl.appendChild(knob);break;case"Itemized":var select=document.createElement("mui-select");select.link(plugin,param),targetEl.appendChild(select)}}},$:function(elementId){return document.getElementById(elementId)}}}(WX),function(WX){function Fader(preset){WX.Plugin.defineType(this,"Processor"),this._input.connect(this._output),WX.defineParams(this,{mute:{type:"Boolean","default":!1},dB:{type:"Generic",unit:"Decibels","default":0,min:-90,max:12}}),WX.Plugin.initPreset(this,preset)}Fader.prototype={info:{name:"Fader",api_version:"1.0.0-alpha",plugin_version:"1.0.0",author:"hoch",type:"Processor",description:"channel fader"},defaultPreset:{mute:!1,dB:0},$mute:function(value){value?this._outlet.gain.set(0,WX.now,0):this._outlet.gain.set(1,WX.now,0)},$dB:function(value,time,xtype){this._output.gain.set(WX.dbtolin(value),time,xtype)}},WX.Plugin.extendPrototype(Fader,"Processor"),WX.Plugin.register(Fader),WX.Master=WX.Fader(),WX.Master.to(WX.context.destination)}(WX);
//# sourceMappingURL=waax.map