<!DOCTYPE html>
<html>
  <head>
    <link href="static/demos.css" rel="stylesheet" type="text/css">
    <link href="../lib/UI/UI-light.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    
    <div class="c-demohome"><a href="index.html">Index</a></div>
    <h1>Dreamy Impulse</h1>
    <div class="c-body-wrapper" id="i-container">
      <h2>Audio Signal Flow</h2>
      <ul class="c-signalflow">
        <li>Impulse Train</li> <li class="separator"></li>
        <li>LPF</li> <li class="separator"></li>
        <li>Pingpong</li> <li class="separator"></li>
        <li>Converb</li> <li class="separator"></li>
        <li>DAC</li>
      </ul>
      <ul class="c-signalflow">
        <li>LFO + Step</li> <li class="separator"></li>
        <li>LPF: Frequency</li>
      </ul>
    </div>

    <!-- lib r8 -->   
    <script src="../src/core/WAAX.js"></script>
    <script src="../src/core/Utils.js"></script>
    <script src="../src/core/Builtin.js"></script>
    <script src="../src/core/Unit.js"></script>
    <script src="../src/generator/Oscil.js"></script>
    <script src="../src/generator/Fmop.js"></script>
    <script src="../src/generator/Noise.js"></script>
    <script src="../src/generator/ITrain.js"></script>
    <script src="../src/generator/Sampler.js"></script>
    <script src="../src/generator/Step.js"></script>
    <script src="../src/processor/Fader.js"></script>
    <script src="../src/processor/Spatter.js"></script>
    <script src="../src/processor/ADSR.js"></script>
    <script src="../src/processor/Filter.js"></script>
    <script src="../src/processor/Filterbank.js"></script>
    <script src="../src/processor/Formant.js"></script>
    <script src="../src/processor/FormantV.js"></script>
    <script src="../src/processor/Pingpong.js"></script>
    <script src="../src/processor/Chorus.js"></script>
    <script src="../src/processor/Phasor.js"></script>
    <script src="../src/processor/Comp.js"></script>
    <script src="../src/processor/Converb.js"></script>
    <script src="../src/analyzer/Waveform.js"></script>
    <script src="../src/analyzer/Spectrum.js"></script>
    <script src="../src/core/Boot.js"></script>
    <!-- Ktrl -->
    <script src="../lib/Ktrl/Ktrl.js"></script>
    <script src="../lib/UI/UI.js"></script>
    <script src="../lib/UI/UISlider.js"></script>
    <script src="../lib/UI/UIButton.js"></script>
    <script src="../lib/UI/UIIndexedList.js"></script>
    <!-- scripts -->
    <script>
      // units
      var uLfo = WX.Oscil({ gain:1250.0, freq:0.125 });
      var uStp = WX.Step({ gain:1250.0 });
      var uImp = WX.ITrain({ gain:2.2, freq:6 });
      var uLpf = WX.Filter({ cutoff:125, Q:24 });
      var uPong = WX.Pingpong({ 
        delayTimeLeft: 0.600, delayTimeRight: 0.450, 
        feedbackLeft: 0.3, feedbackRight: 0.5, crosstalk: 0.25 
      });
      var uVerb = WX.Converb({ mix: 0.8 });
    
      // connection
      uImp.to(uLpf).to(uPong).to(uVerb).to(WX.DAC);
      uStp.control(uLpf.cutoff_);
      uLfo.control(uLpf.cutoff_);

      // DEPRECATED: dream on
      // function dream() {
      //   var t1 = WX.now + 4, 
      //       t2 = WX.now + 8;
      //   uLpf
      //     .cutoff(125).Q(12)
      //     .cutoff(2500 + Math.random() * 4000, t1, "x").Q(36, t1, "l")
      //     .cutoff(125, t2, "x").Q(12, t2, "l");
      //   setTimeout(dream, 8000);
      // }
      // dream();

      // ui
      var section_preset = UI.ControlCenter.createSection("Control", "i-container");
      
      var s_lfoRate = UI.ControlCenter.createControl({
        type: "slider", name: "LFO Rate", value: 0.125, min: 0.1, max: 20.0,
        precision: 2, scale: "log", unit: "Hz"
      }, section_preset);
      var s_lfoDepth = UI.ControlCenter.createControl({
        type: "slider", name: "LFO Depth", value: 2500.0, min: 0.0, max: 6500.0,
        precision: 2, scale: "linear", unit: ""
      }, section_preset);
      var s_impFreq = UI.ControlCenter.createControl({
        type: "slider", name: "Imp Frequency", value: 6.0, min: 0.1, max: 20.0,
        precision: 2, scale: "log", unit: "Hz"
      }, section_preset);
      var s_filtCutoff = UI.ControlCenter.createControl({
        type: "slider", name: "Cutoff", value: 125.0, min: 125.0, max: 7000.0,
        precision: 2, scale: "log", unit: "Hz"
      }, section_preset);
      var s_filtQ = UI.ControlCenter.createControl({
        type: "slider", name: "Q", value: 24.0, min: 12.0, max: 36.0,
        precision: 2, scale: "linear", unit: ""
      }, section_preset);
      var s_dlyTime = UI.ControlCenter.createControl({
        type: "slider", name: "Delay Time", value: 0.6, min: 0.001, max: 1.0,
        precision: 2, scale: "linear", unit: ""
      }, section_preset);
      var s_verbMix = UI.ControlCenter.createControl({
        type: "slider", name: "Reverb Mix", value: 0.8, min: 0.0, max: 1.0,
        precision: 2, scale: "linear", unit: ""
      }, section_preset);
      
      // assign actions
      s_lfoRate.addAction(function (value) {
        uLfo.freq(value, WX.now + 0.02, "x");
      });
      s_lfoDepth.addAction(function (value) {
        uStp.gain(value * 0.5, WX.now + 0.02, "l");
        uLfo.gain(value * 0.5, WX.now + 0.02, "l");
      });
      s_impFreq.addAction(function (value) {
        uImp.freq(value, WX.now + 0.02, "x");
      });
      s_filtCutoff.addAction(function (value) {
        uLpf.cutoff(value, WX.now + 0.02, "x");
      });
      s_filtQ.addAction(function (value) {
        uLpf.Q(value, WX.now + 0.02, "l");
      });
      s_verbMix.addAction(function (value) {
        uVerb.mix(value, WX.now + 0.02, "l");
      });
      s_dlyTime.addAction(function (value) {
        uPong.delayTimeLeft(value, WX.now + 0.02, "l");
        uPong.delayTimeLeft(value * 0.75, WX.now + 0.02, "l");
      });

      // ktrl onready
      Ktrl.ready(function () {
        Ktrl.report();
      });

    </script>
  </body>
</html>