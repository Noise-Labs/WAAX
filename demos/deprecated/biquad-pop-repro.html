<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <h1>Pink!</h1>

    <canvas id="spectrum" width="900" height="600"></canvas>
    <input id="rolloff" type="range" min="-60" max="-3" step="0.1" value="-3" style="width: 400px;">
    <div id="rollofflabel"></div>
    <input id="freq" type="range" min="0" max="1000" step="1" value="440" style="width: 400px;">
    <div id="freqlabel"></div>

    <input type="radio" name="filtertype" onmousedown="setFilterType(this)" value="lowpass">Lowpass</input>
    <input type="radio" name="filtertype" onmousedown="setFilterType(this)" value="highpass">Highpass</input>
    <input type="radio" name="filtertype" onmousedown="setFilterType(this)" value="bandpass">Bandpass</input>
    <input type="radio" name="filtertype" checked="true" onmousedown="setFilterType(this)" value="highshelf">Highshelf</input>
    <input type="radio" name="filtertype" onmousedown="setFilterType(this)" value="lowshelf">Lowshelf</input>
    <input type="radio" name="filtertype" onmousedown="setFilterType(this)" value="allpass">Allpass</input>
    <input type="radio" name="filtertype" onmousedown="setFilterType(this)" value="notch">Notch</input>
    
    <!-- lib r8 -->   
    <script src="../src/core/Monkey.js"></script>
    <script src="../src/core/WAAX.js"></script>
    <script src="../src/core/Utils.js"></script>
    <script src="../src/core/Builtin.js"></script>
    <script src="../src/core/Unit.js"></script>
    <script src="../src/generator/Oscil.js"></script>
    <script src="../src/generator/Fmop.js"></script>
    <script src="../src/generator/Noise.js"></script>
    <script src="../src/generator/ITrain.js"></script>
    <script src="../src/generator/Sampler.js"></script>
    <script src="../src/generator/Step.js"></script>
    <script src="../src/processor/Fader.js"></script>
    <script src="../src/processor/Spatter.js"></script>
    <script src="../src/processor/ADSR.js"></script>
    <script src="../src/processor/Filter.js"></script>
    <script src="../src/processor/Formant.js"></script>
    <script src="../src/processor/FormantV.js"></script>
    <script src="../src/processor/Pingpong.js"></script>
    <script src="../src/processor/Chorus.js"></script>
    <script src="../src/processor/Phasor.js"></script>
    <script src="../src/processor/Comp.js"></script>
    <script src="../src/processor/Converb.js"></script>
    <script src="../src/analyzer/Waveform.js"></script>
    <script src="../src/analyzer/Spectrum.js"></script>
    <script src="../src/core/Boot.js"></script>
    
    <!-- test code -->
    <script>
     // ui + gfx
      var cvs = document.getElementById('spectrum');
      var ctx = cvs.getContext('2d');
      
      var rolloff = document.getElementById('rolloff');
      var rollofflabel = document.getElementById('rollofflabel');
      
      var freq = document.getElementById('freq');
      var freqlabel = document.getElementById('freqlabel');

      var n = WX.Noise({ gain:0.25 }),
          v1 = WX.Spectrum({ context:ctx, autoClear:false, smoothingFactor:0.85, grid:true });
      var s = WX.context.createBiquadFilter();
      s.type = "highshelf";
      
      // this pops
      // s.frequency.setValueAtTime(1, WX.now);
      // s.gain.setValueAtTime(-3, WX.now);

      // this doesn't
      s.frequency.setValueAtTime(1000, WX.now);
      s.gain.setValueAtTime(-3, WX.now);

      //var g = WX.context.createGain();

      n.connect(s);
      s.connect(v1._inlet);
      s.connect(WX.context.destination);

      WX.DAC.db(-12);
      WX.DAC.type("mono");

      var rampTime = 0.05;

      rolloff.onchange = function () {
        //s.gain.linearRampToValueAtTime(rolloff.value, WX.now+rampTime);
        s.gain.setTargetAtTime(rolloff.value, WX.now, 0.200);
        rollofflabel.textContent = rolloff.value + "dB";
      };

      freq.onchange = function () {
        s.frequency.exponentialRampToValueAtTime(freq.value, WX.now+rampTime);
        freqlabel.textContent = freq.value + "Hz";
      };

      function setFilterType (e) {
        s.type = e.value;
      }

      rollofflabel.textContent = rolloff.value + "dB";
      freqlabel.textContent = freq.value + "Hz";

      // draw
      function draw() {
        requestAnimationFrame(draw);
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        v1.draw();
      }
      draw();

    </script>

  </body>
</html>