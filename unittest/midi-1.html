<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <h1>web midi pilot</h1>
    
<script src="../src/core/Monkey.js"></script>
    <script src="../src/core/WAAX.js"></script>
    <script src="../src/core/Utils.js"></script>
    <script src="../src/core/Builtin.js"></script>
    <script src="../src/core/Unit.js"></script>
    <script src="../src/generator/Oscil.js"></script>
    <script src="../src/generator/Fmop.js"></script>
    <script src="../src/generator/Noise.js"></script>
    <script src="../src/generator/ITrain.js"></script>
    <script src="../src/generator/ITrain2.js"></script>
    <script src="../src/generator/Sampler.js"></script>
    <script src="../src/generator/Step.js"></script>
    <script src="../src/processor/Fader.js"></script>
    <script src="../src/processor/ADSR.js"></script>
    <script src="../src/processor/Filter.js"></script>
    <script src="../src/processor/Formant.js"></script>
    <script src="../src/processor/FormantV.js"></script>
    <script src="../src/processor/Pingpong.js"></script>
    <script src="../src/processor/Chorus.js"></script>
    <script src="../src/processor/Phasor.js"></script>
    <script src="../src/processor/Comp.js"></script>
    <script src="../src/processor/Converb.js"></script>
    <script src="../src/core/Boot.js"></script>

    <script>
var s1 = WX.Sampler({ source:"../data/samples/kick-1.wav" });
var s2 = WX.Sampler({ source:"../data/samples/snare-1.wav" });
var s3 = WX.Sampler({ source:"../data/samples/hihat-1.wav" });
  s1.to(WX.DAC);
  s2.to(WX.DAC);
  s3.to(WX.DAC);



     var midi = null;  // global MIDIAccess object

function onMIDISuccess( midiAccess ) {
  console.log( "MIDI ready!" );
  midi = midiAccess;  // store in the global (in real usage, would probably keep in an object instance)
  console.dir(midi);
  listInputsAndOutputs(midi);
  startLoggingMIDIInput(midi, 1);
}

function onMIDIFailure(msg) {
  console.log( "Failed to get MIDI access - " + msg );
}

navigator.requestMIDIAccess().then( onMIDISuccess, onMIDIFailure );

function listInputsAndOutputs( midiAccess ) {
  var inputs = midiAccess.inputs();
  var outputs = midiAccess.outputs();
  var i;

  for (i=0; i<inputs.length; i++) {
    console.log( "Input port #" + i + 
      ": type:'" + inputs[i].type +
      "' id:'" + inputs[i].id +
      "' manufacturer:'" + inputs[i].manufacturer +
      "' name:'" + inputs[i].name +
      "' version:'" + inputs[i].version + "'" );
  }

  for (i=0; i<outputs.length; i++) {
    console.log( "Output port #" + i + 
      ": type:'" + outputs[i].type +
      "' id:'" + outputs[i].id +
      "' manufacturer:'" + outputs[i].manufacturer +
      "' name:'" + outputs[i].name +
      "' version:'" + outputs[i].version + "'" );
  }
}

function onMIDIMessage( event ) {
  var str = "MIDI message received at timestamp " + event.timestamp + "[" + event.data.length + " bytes]: ";
  var d = event.data;
  if (d.length === 3) {
    var b1 = d[0].toString(16);
    var b2 = d[1].toString(16);
    var b3 = d[2].toString(16);
    if (b1 === "99") {
      switch(b2) {
        case "30":
          s1.start(60);
        break;
        case "36":
          s3.start(60);
        break;
        case "3a":
          s2.start(60);
        break;
      }
    } else {
      switch(b2) {
        case "30":
        break;
        case "3a":
        break;
      }
    }
  }
  for (var i=0; i<event.data.length; i++) {  
    var key = event.data[i].toString(16);
    str += "0x" + key + " ";
  }

  console.log( str );
}

function startLoggingMIDIInput( midiAccess, indexOfPort ) {
  var input = midiAccess.inputs()[indexOfPort];
  console.dir(input);
  input.onmidimessage = onMIDIMessage;
}



    </script>
  </body>
</html>

