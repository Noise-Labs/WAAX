<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>WAAX.js - Web Audio API eXtenstion</title>

</head>

<body>
<h1><a href="index.html">Index</a></h1>

<div id="msg"></div>
<div id="timer"></div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="WAAX.js"></script>
<script src="core/Util.js"></script>
<script src="core/Timebase.js"></script>
<script src="core/Clip.js"></script>
<script src="core/Fader.js"></script>
<script src="core/Oscil.js"></script>
<script src="core/Sampler.js"></script>
<script src="core/LPF.js"></script>
<script src="core/ADSR.js"></script>
<script src="core/Delay.js"></script>
<script src="core/ConVerb.js"></script>

<script>

var myMod = new WX.Oscil({ frequency: 100, gain: 10.0 });
var myCar = new WX.Oscil({ type: "SAW", frequency: 880, gain: 0.7 });
var mySamp = new WX.Sampler("core/samples/flute.wav")
var myLpf = new WX.LPF();
var myAdsr = new WX.ADSR(5, 15, 0.35, 60);
var myDly = new WX.Delay(250, 0.15);
var myVerb = new WX.ConVerb("core/ir/1644-ambiencehall.wav");
var myClip = new WX.Clip(5.0);

mySamp.setBasePitch(69); // A4
myLpf.setCutoff(1200.0).setQ(4.0);
myDly.setFeedbackGain(0.5);
myVerb.setMix(0.25);

myMod.to(myCar).to(myLpf).to(myAdsr).to(myDly).to(myVerb).to(WX.Out);
mySamp.to(myAdsr);

WX.TB.add(myClip);

var pitches = [0, 4, 5, 7, 11, 12];

$(document).keydown(function(event) {
  if (event.which == 81 && myAdsr.running === false) {
    event.preventDefault();
    var pitch = pitches[WX.random2(0, 5)] + 12 * WX.random2(3, 5);
    var freq = WX.midi2freq(pitch);
    var Q = WX.random2f(1.0, 8.0);
    myMod.setGain(WX.random2f(2.0, 8.0)).setFreq(freq * 5);
    myCar.setFreq(freq);
    myLpf.setCutoff(freq * 5).setQ(Q);
    mySamp.start(60 + pitches[WX.random2(0, 5)]);
    myAdsr.start();
  }
});

$(document).keyup(function(event) {
  if (event.which == 81) {
    event.preventDefault();
    mySamp.stop();
    myAdsr.release();
  }
});

$(document).keypress(function(event) {
  if (event.which === 46) {
    if (WX.Out.muted === false) {
      WX.Out.mute();
    } else {
      WX.Out.unmute();
    }
  }
});

window.addEventListener('load', function() {
    console.log('loaded. - go!');
});

</script>

</body>

</html>