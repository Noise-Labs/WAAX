<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>WAAX.js - Web Audio API eXtenstion</title>
</head>
<body>
<h1>Hello WAAX!</h1>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/WAAX.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/Util.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/Fader.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/Oscil.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/ADSR.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/Sampler.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/Noise.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/LFO.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/FeedbackDelay.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/ConVerb.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/Comp.js"></script>
<script src="https://github.com/hoch/WAAX/raw/master/core/LPF.js"></script>

<script>
// resource path
var PATH_IR = "https://github.com/hoch/WAAX/raw/master/ir/",
    PATH_SAMPLES = "https://github.com/hoch/WAAX/raw/master/samples/";

// FM sound with low-pass filter and ADSR envelope
var mod = new WX.Oscil({ frequency:50, gain:2.0 }),
    car = new WX.Oscil({ type:1, frequency:880, gain:0.7 }),
    lpf = new WX.LPF({ cutoff: 1200.0, Q: 4.0 }),
    adsr = new WX.ADSR({ a:0.005, d:0.015, s:0.15, r:0.5, gain:0.5 });
// connecting units
mod.to(car).to(lpf).to(adsr).to(WX.Out);

// a simple drum sampler with compressor, reverb, and delay
var kd = new WX.Sampler({ source:PATH_SAMPLES + "kick-2.wav" }),
    sd = new WX.Sampler({ source:PATH_SAMPLES + "snare-2.wav" }),
    hh = new WX.Sampler({ source:PATH_SAMPLES + "hihat-2.wav" }),
    comp1 = new WX.Comp({ threshold:-20.0, ratio:8.0 }),
    verb1 = new WX.ConVerb({ source:PATH_IR + "hall.wav", mix: 0.5 }),
    delay1 = new WX.FeedbackDelay({ delayTime:0.2, feedback:0.7, mix:0.25 });
// connecting and setting units
kd.to(comp1).to(WX.Out);
sd.to(verb1).to(WX.Out);
hh.to(delay1).to(WX.Out);
comp1.gain = 2.0;

// noise with tremolo by LFO
var noise = new WX.Noise({ type:'white' }),
    lfo = new WX.LFO({ rate:0.5, shape:0 }),
    fader1 = new WX.Fader();
// connecting and setting units    
noise.to(fader1).to(WX.Out);
fader1.modulateWith(lfo);
noise.gain = 0.01;

// some other stuff
var pitches = [0, 4, 5, 7, 11, 12];
var keyFilter = false;

// key input handling
$(document).keydown(function(event) {
  if (event.which == 81 && keyFilter === false) {
    event.preventDefault();
    keyFilter = true;
    var pitch = pitches[WX.random2(0, 5)] + 12 * WX.random2(3, 5),
        freq = WX.midi2freq(pitch),
        qual = WX.random2f(5.0, 12.0);
    mod.gain = WX.random2f(2.0, 8.0);
    mod.frequency = freq * 12;
    car.frequency = freq;
    lpf.cutoff = freq * 5;
    lpf.Q = qual;
    adsr.noteOn();
  }
  switch(event.which) {
    case 191:
      kd.noteOn();
      break;
    case 16:
      sd.noteOn();
      break;
    case 76:
      hh.noteOn();
      break;
  }
});

$(document).keyup(function(event) {
  if (event.which == 81) {
    event.preventDefault();
    adsr.noteOff();
    keyFilter = false;
  }
  switch(event.which) {
    case 191:
      kd.noteOff();
      break;
    case 16:
      sd.noteOff();
      break;
    case 76:
      hh.noteOff();
      break;
  }
});

window.addEventListener('load', function() {
});

</script>

</body>
</html>